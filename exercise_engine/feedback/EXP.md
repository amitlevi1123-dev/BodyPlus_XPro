מושלם ✅
הנה קובץ מלא ומעוצב בשם **`README_CAMERA_AUDIT.md`** — הוא כולל את כל ההסבר, המבנה, האיפיון והמדדים, כתוב בשפה שלך וברור גם למי שלא מתכנת.
תשמור אותו ליד הקובץ `camera_wizard.py` בתיקייה:
`exercise_engine/feedback/README_CAMERA_AUDIT.md`

---

````markdown
# 📸 Camera Audit & Wizard — מערכת בקרת מצלמה ובדיקת איכות סט

מערכת **Camera Audit** בודקת אם תנאי הצילום בזמן האימון היו מספיק טובים למדידה אמינה.  
היא משלבת שני מנגנונים משלימים:

1. **Camera Wizard** — אשף בזמן אמת שמזהה בעיות (תאורה, זווית, זרימה) ונותן חיווי קולי או טקסטואלי, רק כשבאמת צריך.  
2. **Set Visibility Audit** — בודק בסוף כל סט אם המצלמה הצליחה לזהות אותך היטב לאורך כל הזמן, ומפיק דו"ח מסכם חכם.  
3. **Save Audit JSON** — שומר את התוצאה הסופית בתיקיית `reports/` כקובץ JSON קריא וברור.

---

## 🧠 מטרת המערכת
לספק חיווי מדויק ומקצועי על איכות הצילום, בלי להציף התראות מיותרות.  
המערכת יודעת לזהות:
- אם יש מספיק תאורה.
- אם הזווית תקינה ורואים את כל הגוף.
- אם המצלמה “קופאת” או איטית מדי.
- אם הביטחון בזיהוי הפוזה נמוך מדי.
- כמה זמן במהלך הסט המשתמש בכלל נראה.

---

## ⚙️ מבנה המודול

| קובץ | תפקיד |
|------|--------|
| `camera_wizard.py` | מכיל את שני החלקים: Camera Wizard בזמן אמת + Set Visibility Audit בסוף סט. |
| `report_builder.py` | מוסיף את תוצאות האודיט לדו"ח הכללי של התרגיל (`report["camera"]`). |
| `runtime.py` | מפעיל את האודיט בתחילת/סוף סט, אוסף נתונים ומחבר את הכל לדו"ח סופי. |
| `reports/` | תיקייה שבה נשמרים קבצי הסיכום (`set_summary_YYYYMMDD_HHMMSS.json`). |

---

## 🧩 איפיון כללי

### שלבי העבודה
1. בתחילת סט → הפעלת מעקב מצלמה:
   ```python
   {"set.begin": True, "set.index": 1}
````

2. במהלך הסט → שליחת פריימים רגילים עם מדדים (`average_visibility`, `confidence`, `dt_ms`, וכו').
3. בסוף הסט → סגירת המעקב ויצירת דו"ח:

   ```python
   {"set.end": True}
   ```

### התוצאה

הדו"ח הסופי כולל בלוק `"camera"` עם כל הנתונים, למשל:

```json
"camera": {
  "visibility_risk": false,
  "severity": "LOW",
  "message": "המדידה תקינה",
  "stats": {
    "frames": 420,
    "duration_s": 8.4,
    "avg_visibility": 0.67,
    "bad_dt_pct": 0.03,
    "notes": []
  }
}
```

---

## 🧠 חלק א' — Camera Wizard (בזמן אמת)

### תפקיד

לזהות בעיות טכניות בזמן האימון ולהתריע רק כשבאמת צריך.
המערכת **לא מדברת כל הזמן**, אלא רק אם:

* זוהה אדם בפריים.
* עברה לפחות 2 שניות מההתראה הקודמת.
* אותה התראה לא נאמרה כבר יותר מפעמיים.
* רמת הקריטיות של ההודעה היא **HIGH** או יותר.

### המדדים שנבדקים בזמן אמת

| מדד                                               | תיאור                           | שימוש                                |
| ------------------------------------------------- | ------------------------------- | ------------------------------------ |
| `average_visibility`                              | מדד כמה הגוף נראה בפריים (0–1). | קובע אם התאורה מספקת והזווית טובה.   |
| `confidence`                                      | ביטחון הזיהוי של הפוזה/מדידות.  | עוזר לדעת אם המצלמה “רואה” אותך טוב. |
| `dt_ms`                                           | זמן בין פריימים (milliseconds). | מזהה FPS נמוך או קפיאות.             |
| `availability.pose` / `availability.measurements` | האם המערכת מזהה שלד או מדידות.  | מאפשר לזהות אם יש אדם בפריים.        |

### סוגי הודעות

| סוג          | רמת חומרה | טקסט                                                         |
| ------------ | --------- | ------------------------------------------------------------ |
| איטיות וידאו | HIGH      | "הזרימה איטית – סגור אפליקציות כבדות או הורד רזולוציה."      |
| תאורה חלשה   | HIGH      | "חשוך מדי – הגבר תאורה מקדימה או פנה אל מקור אור."           |
| נראות חלקית  | MEDIUM    | "רואים אותך חלקית – התקרב מעט למצלמה או כוון אותה טוב יותר." |
| תקין         | LOW       | "מצוין – אפשר להתחיל אימון."                                 |

---

## 📈 חלק ב' — Set Visibility Audit (בדיקה בסוף סט)

### מטרה

לבחון את איכות הצילום לכל אורך הסט, ולתת מסקנה אחת פשוטה וברורה:

* **המדידה תקינה**
* **הערה: תנאי צילום גבוליים**
* **אזהרה: ייתכנו טעויות טכניות במדידות**

### מדדים שנמדדים

| מדד                     | שם ב-JSON                 | תיאור                        | סף                                          |
| ----------------------- | ------------------------- | ---------------------------- | ------------------------------------------- |
| מספר פריימים            | `frames`                  | סה"כ פריימים בסט.            | לפחות 30 לפרשנות אמינה.                     |
| משך הסט                 | `duration_s`              | זמן כולל בשניות.             | פחות מ־3–5 שניות → מסקנה שמרנית.            |
| ממוצע נראות             | `avg_visibility`          | ממוצע חשיפה של הגוף למצלמה.  | ≥0.60 תקין / 0.45–0.60 בינוני / <0.45 בעיה. |
| אחוז פריימים חלשים      | `low_visibility_pct`      | אחוז פריימים עם vis < 0.45.  | ≥35% → MEDIUM.                              |
| אחוז חלשים מאוד         | `very_low_visibility_pct` | vis < 0.20.                  | ≥20% → HIGH.                                |
| ביטחון נמוך             | `low_confidence_pct`      | אחוז פריימים עם conf < 0.60. | ≥30% → MEDIUM.                              |
| זמן ממוצע בין פריימים   | `avg_dt_ms`               | מדד ל-FPS בפועל.             | >500ms → איטי.                              |
| זמן מקסימלי בין פריימים | `max_dt_ms`               | פריים הכי איטי שנמדד.        | >1200ms → “קפיאות חריפות”.                  |
| אחוז פריימים איטיים     | `bad_dt_pct`              | אחוז פריימים עם dt > 500ms.  | ≥30% → MEDIUM.                              |
| יחס נוכחות אדם          | `person_ratio`            | כמה מהזמן זוהה אדם בפריים.   | <0.50 → MEDIUM.                             |

### דוגמה לסט בעייתי

```json
"camera": {
  "visibility_risk": true,
  "severity": "HIGH",
  "message": "אזהרה: ייתכנו טעויות טכניות במדידות.",
  "stats": {
    "frames": 312,
    "avg_visibility": 0.31,
    "low_visibility_pct": 0.52,
    "person_ratio": 0.46,
    "notes": ["תאורה/נראות חלשה מאוד", "זרימת וידאו איטית לפרקים"]
  }
}
```

---

## 🧾 חלק ג' — Save Audit JSON

* כל דו"ח נכתב אוטומטית לתיקייה `reports/` תחת שם:

  ```
  set_summary_YYYYMMDD_HHMMSS.json
  ```
* הדו"ח כולל גם `saved_at`, וגם מטא־מידע אם הועבר מה־runtime:

  ```json
  {
    "exercise": "squat",
    "set_index": 1,
    "visibility_risk": false,
    "message": "המדידה תקינה",
    "saved_at": "2025-10-20T13:47:05"
  }
  ```

---

## 🧪 בדיקה מהירה

הקובץ `tests/smoke_camera_audit.py` מריץ שני תרחישים:

1. **סט תקין** — נראות גבוהה, הכל תקין.
2. **סט בעייתי** — תאורה נמוכה ו-FPS איטי → צפויה אזהרה.

להרצה:

```bash
python -m tests.smoke_camera_audit
```

תוצאה צפויה:

```
✅ סט תקין: visibility_risk=False
✅ סט בעייתי: visibility_risk=True
📄 נוצר קובץ דו״ח בתיקיית reports/
```

---

## ⚙️ סיכום

* המערכת בודקת **נראות, ביטחון, זרימה, משך ונוכחות אדם**.
* בזמן אמת היא מדברת רק אם באמת צריך.
* בסוף סט היא נותנת מסקנה אחת קצרה וברורה.
* אין יותר התרעות סתמיות או דוחות סותרים.
* כל הדוחות נשמרים אוטומטית ב־`reports/`.

---

### ✨ קרדיט

פותח כחלק ממנוע BodyPlus_XPro
להבטחת איכות מדידה בתרגילי גוף בזמן אמת,
עם דגש על אמינות, חוויית משתמש נקייה, ודוחות מובנים וברורים.

```

---

רוצה שאוסיף לגרסה הזו גם תרשים זרימה קטן (flow chart) שממחיש איך הסט עובר מהתחלה עד לדו"ח הסופי?
```

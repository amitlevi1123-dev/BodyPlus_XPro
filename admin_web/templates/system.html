{% extends "base.html" %}
{% block title %}מצב מערכת · BodyPlus XPro{% endblock %}
{% block page_title %}מצב מערכת{% endblock %}

{% block content %}
  <header class="mb-4 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold">מצב מערכת</h1>
      <p class="text-sm text-gray-500">תצוגה חיה של עומסים ונתוני מכונה</p>
    </div>
    <div class="flex gap-2 text-sm">
      <span id="chip-cpu" class="px-3 py-2 rounded-lg bg-gray-100">CPU: --%</span>
      <span id="chip-ram" class="px-3 py-2 rounded-lg bg-gray-100">RAM: --%</span>
      <span id="chip-gpu" class="px-3 py-2 rounded-lg bg-gray-100">GPU: --</span>
      <span id="chip-fps" class="px-3 py-2 rounded-lg bg-gray-100">FPS: --</span>
    </div>
  </header>

  <section class="space-y-6">

    <!-- גריד סיכום -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
      <div class="bg-white shadow rounded-xl p-4 text-center">
        <div class="text-xs text-gray-500 mb-1">CPU</div>
        <div id="sys-cpu" class="text-3xl font-semibold">--%</div>
        <div id="sys-cpu-temp" class="text-xs text-gray-500 mt-1">טמפ': --°C</div>
      </div>
      <div class="bg-white shadow rounded-xl p-4 text-center">
        <div class="text-xs text-gray-500 mb-1">RAM</div>
        <div id="sys-ram" class="text-3xl font-semibold">--%</div>
        <div id="sys-ram-used" class="text-xs text-gray-500 mt-1">-- / -- GB</div>
      </div>
      <div class="bg-white shadow rounded-xl p-4 text-center">
        <div class="text-xs text-gray-500 mb-1">GPU</div>
        <div id="sys-gpu" class="text-3xl font-semibold">--</div>
        <div id="sys-gpu-sub" class="text-xs text-gray-500 mt-1">—</div>
      </div>
      <div class="bg-white shadow rounded-xl p-4 text-center">
        <div class="text-xs text-gray-500 mb-1">FPS</div>
        <div id="sys-fps" class="text-3xl font-semibold">--</div>
        <div class="text-xs text-gray-500 mt-1">קצב מעודכן מהאפליקציה</div>
      </div>
    </div>

    <!-- פרוסס נוכחי + דיסק/רשת -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white shadow rounded-xl p-4">
        <div class="text-sm font-bold mb-2">תהליך נוכחי</div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">CPU%</span><span id="proc-cpu" class="font-semibold">--</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">זיכרון (RSS)</span><span id="proc-mem" class="font-semibold">-- GB</span>
        </div>
      </div>

      <div class="bg-white shadow rounded-xl p-4">
        <div class="text-sm font-bold mb-2">דיסק</div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">שימוש</span><span id="disk-usage" class="font-semibold">--%</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">קריאה</span><span id="disk-r" class="font-semibold">--</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">כתיבה</span><span id="disk-w" class="font-semibold">--</span>
        </div>
      </div>

      <div class="bg-white shadow rounded-xl p-4">
        <div class="text-sm font-bold mb-2">רשת</div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">קבלה</span><span id="net-rx" class="font-semibold">--</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-gray-500">שליחה</span><span id="net-tx" class="font-semibold">--</span>
        </div>
      </div>
    </div>

    <!-- מידע סביבתי -->
    <div class="bg-white shadow rounded-xl p-4">
      <div class="flex items-center justify-between mb-2">
        <div class="text-lg font-bold">מידע סביבתי (Environment)</div>
        <span id="env-docker-badge" class="px-3 py-2 rounded-lg text-sm bg-gray-100 hidden">Docker</span>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2 text-sm">
        <div><span class="text-gray-500">Host:</span> <span id="env-host" class="font-semibold">—</span></div>
        <div><span class="text-gray-500">OS:</span> <span id="env-os" class="font-semibold">—</span></div>
        <div><span class="text-gray-500">Python:</span> <span id="env-py" class="font-semibold">—</span></div>
        <div><span class="text-gray-500">PID:</span> <span id="env-pid" class="font-semibold">—</span></div>
        <div><span class="text-gray-500">Uptime:</span> <span id="env-uptime" class="font-semibold">—</span></div>
        <div><span class="text-gray-500">NVML/CUDA:</span> <span id="env-gpu-flags" class="font-semibold">—</span></div>
      </div>
    </div>

    <!-- פירוט מלא (JSON) -->
    <div class="bg-white shadow rounded-xl p-4">
      <div class="flex items-center justify-between">
        <div class="text-lg font-bold">פירוט מלא (JSON)</div>
        <button id="btn-copy" class="px-3 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200">העתק</button>
      </div>
      <pre id="sys-details" class="mt-3 bg-gray-50 rounded p-3 overflow-auto max-h-[420px] text-xs" style="direction:ltr;text-align:left;">{} </pre>
    </div>

  </section>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    // כפתור העתקה (עובד גם בלי ה-JS הראשי)
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('btn-copy');
      btn?.addEventListener('click', () => {
        const pre = document.getElementById('sys-details');
        if (!pre) return;
        const txt = pre.textContent || '';
        navigator.clipboard.writeText(txt).then(()=> {
          btn.textContent = 'הועתק ✓';
          setTimeout(()=> btn.textContent='העתק', 1200);
        }).catch(()=>{});
      });
    });
  </script>
  <script src="{{ url_for('static', filename='js/system.js') }}?v={{ app_version|default('dev', true) }}" defer></script>
{% endblock %}

# -*- coding: utf-8 -*-
# -------------------------------------------------------------------
# 📘 exercise_family_template.yaml — תבנית בסיסית למשפחת תרגילים
# -------------------------------------------------------------------
# הקובץ הזה מגדיר את הבסיס לכל תרגילי המשפחה (לדוגמה: כל סוגי הסקוואט)
# הוא לא נבחר ישירות באימון — רק מספק חוקים כלליים שווריאנטים יורשים מהם.
# -------------------------------------------------------------------

# מזהה פנימי ייחודי למשפחה (חייב להיות ייחודי)
id: <family_name>.base          # דוגמה: squat.base

# שם המשפחה שאליה שייכים התרגילים
family: <family_name>           # דוגמה: squat

meta:
  # האם התרגיל הזה ניתן לבחירה? (בדרך כלל false בקובץ בסיס)
  selectable: false

  # שם תצוגה שייראה יפה בממשק
  display_name: "<Family Name> (Base)"   # דוגמה: "Squat (Base)"

# -------------------------------------------------------------------
# 🧠 קריטריונים בסיסיים — על מה נותנים ציון
# -------------------------------------------------------------------
# כל קריטריון מייצג מדד טכני: יציבה, עומק, מהירות חזרה, רוחב עמידה, וכו’.
# המפתח 'requires' מציין אילו נתונים (מהמדידות) חייבים להיות זמינים כדי לחשב את הציון.
# כל שם שמופיע כאן חייב להיות מוגדר כ־canonical ב־aliases.yaml.
criteria:
  posture:        { requires: [torso_forward_deg] }  # זווית הגו מול אנכי
  depth:          { requires: [knee_left_deg, knee_right_deg] }  # עומק ברכיים
  tempo:          { requires: [rep.timing_s] }  # משך חזרה בשניות
  stance_width:   { requires: [features.stance_width_ratio] }  # יחס רוחב עמידה לכתפיים
  knee_valgus:    { requires: [knee_foot_alignment_left_deg, knee_foot_alignment_right_deg] }  # קו ברך מול כף הרגל

# -------------------------------------------------------------------
# ⚠️ קריטריונים קריטיים — אם אחד מהם חסר → לא ניתן לנקד
# -------------------------------------------------------------------
critical: [posture, depth]

# -------------------------------------------------------------------
# ⚖️ משקלים — כמה כל קריטריון משפיע על הציון הכולל
# -------------------------------------------------------------------
weights:
  posture: 1.0        # משקל רגיל
  depth: 1.5          # עומק חשוב יותר, אז משקל גבוה יותר
  tempo: 0.5          # טמפו פחות חשוב
  stance_width: 0.5
  knee_valgus: 1.0

# -------------------------------------------------------------------
# 🎯 ספי הערכה — קובעים מתי ציון הוא "טוב", "בינוני" או "גרוע"
# -------------------------------------------------------------------
thresholds:
  posture:
    max_good_deg: 15   # אם הנטייה קדימה ≤15° → ציון מלא
    max_ok_deg: 25     # בין 15°–25° → בינוני
    max_bad_deg: 45    # מעל 45° → גרוע (0)
  depth:
    knee_target_deg: 90    # עומק מטרה (90° = טוב)
    knee_cutoff_deg: 150   # מעבר לזה → גרוע
  tempo:
    min_s: 0.7
    max_s: 2.5
    min_cutoff_s: 0.4
    max_cutoff_s: 4.0
  stance_width:
    min_ok: 0.9
    max_ok: 1.2
    min_cutoff: 0.7
    max_cutoff: 1.5
  knee_valgus:
    ok_deg: 5
    warn_deg: 10
    bad_deg: 20

# -------------------------------------------------------------------
# 🛑 תקרות בטיחות (לא חובה)
# -------------------------------------------------------------------
# מאפשר לקבוע מגבלה על הציון הכולל במקרה שאחד הקריטריונים נמוך במיוחד.
safety_caps:
  - when: "posture <= 0.5"   # אם היציבה גרועה (ציון ≤0.5)
    cap: 0.7                 # הגבול העליון לציון הכולל יהיה 0.7

# -------------------------------------------------------------------
# 🏅 מדרג באותיות (לא חובה)
# -------------------------------------------------------------------
# משמש להצגת ציון איכות מילולית (A/B/C)
grade_bands: { A: 0.85, B: 0.75, C: 0.6 }

# -------------------------------------------------------------------
# 🧭 רמזים למסווג התרגילים (לא חובה)
# -------------------------------------------------------------------
# עוזר למערכת לזהות את המשפחה הנכונה בזמן זיהוי אוטומטי.
match_hints:
  must_have: [pose.available]
  pose_view: ["front", "front_left", "front_right"]

# -------------------------------------------------------------------
# 🔁 הגדרות לספירת חזרות (לא חובה)
# -------------------------------------------------------------------
# מציין איזה מדד משמש לזהות תחילת/סוף חזרה.
rep_signal:
  source: "value|min|wrist_left_y_px,wrist_right_y_px"
  thresholds:
    min_rom_good: 30        # טווח תנועה מינימלי (מעלות או פיקסלים)
    min_rep_ms: 400         # חזרה קצרה מדי → פסילה
    max_rep_ms: 6000        # חזרה ארוכה מדי → פסילה

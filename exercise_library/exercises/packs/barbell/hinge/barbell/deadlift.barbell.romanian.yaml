# =============================================================================
# deadlift.barbell.romanian.yaml — Romanian Deadlift (RDL) עם מוט
# נתיב מומלץ: exercise_library/exercises/packs/hinge/barbell/deadlift.barbell.romanian.yaml
# -----------------------------------------------------------------------------
# דגשים:
# • start_mode: from_standing — מתחילים בעמידה, לא מהרצפה
# • תבנית Hinge (לא סקוואט), ברך "פתוחה" יחסית
# • ROM קריטי ונמדד מזוויות ירך/גו בלבד (לא פיקסלים)
# • ספירת חזרה מלאה: ≥95% מהעלייה (אין דרישת "נעילה מלאה" כמו DL קונבנציונלי)
# • שהייה ממושכת מדי למעלה מורידה ניקוד (RDL שומר מתח)
# • בטיחות הגב מודגשת במיוחד
# =============================================================================

id: "deadlift.barbell.romanian"
family: "hinge"
extends: "hinge.base"

meta:
  selectable: true
  display_name: "Romanian Deadlift — Barbell (RDL)"
  equipment: "barbell"
  start_mode: "from_standing"
  version: "1.0.0"
  notes: >
    RDL מן העמידה: דחיפת אגן לאחור, הדגשת טווח אקצנטרי ושמירת מתח.
    אין צורך "לנעול" למעלה — חזרה מלאה נספרת בהשלמת ≥95% מהעלייה.
    שהייה ארוכה למעלה מעידה על אובדן מתח ולכן מנוקדת מטה.
    עומק/ROM מחושבים מזוויות ירך/גו ולכן עמידים למרחק מצלמה.

# -----------------------------------------------------------------------------
# 🧭 רמזי זיהוי למסווג (Classifier Hints)
# -----------------------------------------------------------------------------
match_hints:
  must_have: [pose.available]
  any_of: [objdet.bar_present, objdet.object_present]
  ranges:
    objdet.object_kind: ["barbell"]
  pose_view: ["side", "front_left", "front_right"]
  motion_pattern: ["hip_hinge"]
  joints_focus: ["hips", "spine", "knees"]
  weight: 1.0

# -----------------------------------------------------------------------------
# 🎯 יעדים לווריאנט: ROM מזוויות (Hip/Torso), וקונטרול למעלה
# -----------------------------------------------------------------------------
targets:
  rom_joint:
    hip_rom_deg: 48         # יעד ROM בירך
    torso_rom_deg: 30       # יעד ROM בגו
  top_time_control:
    hold_good_max_s: 0.50   # עד כאן אידאלי (שומר מתח)
    hold_ok_max_s:   1.00   # עדיין טוב
    hold_hard_cap_s: 2.50   # מעבר לכך — קנס ברור

# -----------------------------------------------------------------------------
# ⏱️ חלונות טמפו (הדרכתיים; הניקוד בפועל דרך הקריטריונים)
# -----------------------------------------------------------------------------
tempo_targets:
  rep_t_s:   [1.0, 4.0]
  ecc_s:     [0.8, 3.0]
  con_s:     [0.6, 2.5]
  pause_bot: [0.0, 0.8]   # סט־אפ קצר בתחתית
  pause_top: [0.0, 1.0]   # אין צורך בהחזקה; עדיף קצר כדי לשמור מתח

# -----------------------------------------------------------------------------
# 🦶 מנח רגליים (הכוונה)
# -----------------------------------------------------------------------------
stance_targets:
  stance_width_ratio: [0.85, 1.15]
  toe_angle_deg:      [5, 20]        # גם "קדימה" נסבל
  knee_toe_alignment_ok_abs_deg: 5

# -----------------------------------------------------------------------------
# 🔁 העדפות ספירת חזרות/פאזות
# -----------------------------------------------------------------------------
rep_detection_hints:
  prefer_angles: true            # פאזות/ROM מזוויות ירך/גו
  use_object_y_as_aux: true      # עזר למסלול/יציבות
  min_full_up_fraction: 0.95     # ≥95% מהעלייה נספר כחזרה "מלאה"

# -----------------------------------------------------------------------------
# ⚖️ דריסות ניקוד (scoring) — משקלים 0–2 והגדרות כלליות
# הערה: מניחים כי ב-hinge.base קיימים הקריטריונים הבאים (policy.missing: skip).
# -----------------------------------------------------------------------------
scoring:

  # מדיניות כללית (נשארת מה-base בד"כ)
  policy:
    missing: skip
    min_criteria_for_full_quality: 3

  criteria:

    # -------------------------
    # בטיחות (דגש מוגבר לגב)
    # -------------------------
    spine_rounding:                # עגילת גב (סגיטלי)
      weight: 2.0                  # ↑ חשוב מאוד
      # rule נשאר מה-base (symmetric_threshold spine_flexion_deg)

    lateral_bend:                  # עיקום צדדי
      weight: 1.2

    head_spine:                    # ראש בקו הגו
      weight: 1.0

    # -------------------------
    # תבנית הינג'/מניעת "סקוואט"
    # -------------------------
    hinge_posture:                 # יחס גו/ברך — הינג' אמיתי (לא סקוואט)
      weight: 1.6
      # rule נשאר מה-base (למשל band/ratio ייעודי אם קיים)

    knee_flex_limit:               # ברך "פתוחה" (למנוע סקוואט)
      weight: 1.0
      # rule נשאר מה-base (סף מינ' לזווית ברך)

    # -------------------------
    # ROM מזוויות (קריטי)
    # -------------------------
    rom_joint:                     # Hip/Torso ROM, ציון שמרני = המינ' מבין השניים
      weight: 1.8
      rule:
        kind: rom_joint_min_target
        input: { hip_rom_deg: "auto", torso_rom_deg: "auto" }   # מנוע מחשב Δזוויות
        target_hip_deg:   48
        target_torso_deg: 30
        small_rep_min:    0.30   # <0.30 → לא נספר
        partial_min:      0.50   # 0.30–0.50 → חזרה חלקית
        full_up_fraction: 0.95   # השלמת ≥95% עלייה נחשבת מלאה
        clamp_full_range: [0.95, 1.00]  # טולרנס מלא — לא "קופץ" 99→100

    # -------------------------
    # קצב/שליטה
    # -------------------------
    tempo:
      weight: 1.0

    phase_control:                 # איכות פאזות/היפוך
      weight: 1.2

    # -------------------------
    # רגליים/מנח
    # -------------------------
    knee_valgus:
      weight: 1.2

    heels_grounded:
      weight: 0.8

    stance_width:
      weight: 0.6

    toe_angle:
      weight: 0.5

    # -------------------------
    # היפוך/"טופ" ייחודי ל-RDL
    # -------------------------
    turn_quality:
      weight: 0.6

    top_time_control:              # שהייה למעלה — הורדה רכה לפי זמן
      weight: 0.6
      rule:
        kind: top_hold_penalty
        input: rep.pause_top_s
        good_max_s:   0.50   # ללא הורדה
        ok_max_s:     1.00   # הורדה זעירה/ליניארית
        hard_cap_s:   2.50   # מעבר לכך — הורדה ברורה

  # תקרות בטיחות (מגבילות ציון סופי כשהבטיחות נפגעת)
  safety_caps:
    - when: "spine_rounding <= 0.60"   # גב מעוגל — קפדני יותר
      cap: 0.80
    - when: "knee_valgus   <= 0.60"
      cap: 0.90
    - when: "head_spine    <= 0.60"
      cap: 0.92

  # שקלול סופי
  aggregate:
    method: weighted_mean
    weights_source: inline

# -----------------------------------------------------------------------------
# 📣 חיווט משפטים (phrases)
# -----------------------------------------------------------------------------
phrases:
  namespace: "hinge.rdl"
  inherit_common_maps: true
  # מיפויים אפשריים (אם הוגדרו ב-phrases.yaml):
  maps:
    rom_joint:
      rep_short: "hinge.common.rom_joint.rep_short"
      rep_too_short: "hinge.common.rom_joint.rep_too_short"
      rep_good: "hinge.common.rom_joint.rep_good"
    turn_quality:
      rep_weak: "hinge.common.turn.rep_weak"
      rep_good: "hinge.common.turn.rep_good"
    top_time_control:
      long_hold: "hinge.rdl.top_tension.rep_long_hold"     # דוגמה לשורת פידבק
      too_locked: "hinge.rdl.top_tension.rep_too_locked"

# -----------------------------------------------------------------------------
# 🧪 בדיקות מומלצות (QA)
# -----------------------------------------------------------------------------
qa_notes:
  - "סט א׳ ללא עצירה למעלה מול סט ב׳ עם 2–3s עצירה: ציון ב׳ צריך לרדת דרך top_time_control."
  - "בדוק שחזרות עם 95–100% עלייה נחשבות מלאות (ללא 'קפיצה' בין 99→100)."
  - "ודא ש-ROM מזוויות עובד זהה ממרחקי מצלמה שונים."
  - "וודא שהקריטריונים של הינג' (hinge_posture/knee_flex_limit) מונעים 'סקוואט'."
  - "עגילת גב מחמירה: spine_rounding<0.60 מפעיל cap=0.80 על ציון הסופי."

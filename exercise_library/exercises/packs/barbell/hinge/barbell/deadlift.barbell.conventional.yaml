# =============================================================================
# deadlift.barbell.conventional.yaml â€” ×“×“×œ×™×¤×˜ ×¨×’×™×œ ×¢× ××•×˜ (Conventional Barbell)
# × ×ª×™×‘: exercises/packs/hinge/barbell/deadlift.barbell.conventional.yaml
# -----------------------------------------------------------------------------
# ×”×•×•×¨×™×× ×˜ ×‘× ×•×™ ××¢×œ hinge.base.yaml:
# â€¢ start_mode: from_floor  |  equipment: barbell  |  lockout_mode: full_lockout
# â€¢ ROM × ××“×“ ××–×•×•×™×•×ª ×™×¨×š/×’×• (×œ× ×¤×™×§×¡×œ×™×), ×¢× ×¡×£ ×¡×¤×™×¨×” ×—×œ×§×™/××œ×
# â€¢ × ×¢×™×œ×” ××œ××” ××—×™×™×‘×ª ×¢×¦×™×¨×” ×§×¦×¨×” ×œ××¢×œ×” (â‰¥0.30s) + ×’×‘ × ×™×˜×¨×œ×™ + ×¢×§×‘×™× ×‘××’×¢
# â€¢ ××©×§×œ×™ × ×™×§×•×“ 0â€“2; ×“×’×© ×’×‘×•×” ×¢×œ ROM ×•×¢×œ ×‘×˜×™×—×•×ª ×¢××•×“ ×©×“×¨×” (spine_rounding)
# =============================================================================

meta:
  id: "deadlift.barbell.conventional"
  family: "hinge"
  display_name: "Deadlift â€” Barbell (Conventional)"
  selectable: true
  version: 1.0.0

  # ××“×™× ×™×•×ª ×›×œ×œ×™×ª ×”××’×™×¢×” ××”-BASE
  lockout_mode: "full_lockout"
  start_mode: "from_floor"
  equipment: "barbell"

  notes: >
    ×“×“×œ×™×¤×˜ ×§×•× ×‘× ×¦×™×•× ×œ×™ ××”××•×˜ ×¢×œ ×”×¨×¦×¤×”. ×”×•×•×¨×™×× ×˜ ×× ×§×“ ×—×–×§ ××ª ×¢×•××§ ×”×ª× ×•×¢×” (ROM
    ××–×•×•×™×•×ª ×™×¨×š/×’×•) ×œ×¦×“ ×‘×˜×™×—×•×ª ×¢××•×“-×”×©×“×¨×”. ×¦×™×•×Ÿ ××œ× ××ª×§×‘×œ ×¨×§ ×›×©×™×© × ×¢×™×œ×” ××œ××”
    ×¢× ×¢×¦×™×¨×” ×§×¦×¨×” ×œ××¢×œ×” (â‰¥0.30s), ×’×‘ × ×™×˜×¨×œ×™ ×•×™×¦×™×‘×” × ×§×™×™×”.

# =============================================================================
# ğŸ§­ ×¨××–×™× ×œ××¡×•×•×’ (Classifier Hints)
# =============================================================================
match_hints:
  must_have: [pose.available]
  any_of: [objdet.bar_present, objdet.object_present]
  ranges:
    objdet.object_kind: ["barbell"]
  pose_view: ["side", "front_left", "front_right"]
  motion_pattern: ["hip_hinge"]
  joints_focus: ["hips", "spine", "knees"]
  weight: 1.0

# =============================================================================
# ğŸ¯ ×™×¢×“×™ ROM (××¢×œ ×”-base)
# =============================================================================
targets:
  from_floor:
    hip_deg:   62    # ×™×¢×“ ROM ×‘×™×¨×š ×œ×¦×™×•×Ÿ 1.0
    torso_deg: 36    # ×™×¢×“ ROM ×‘×’×• ×œ×¦×™×•×Ÿ 1.0

# =============================================================================
# â±ï¸ ×—×œ×•× ×•×ª ×˜××¤×• (×”×›×•×•× ×”; ×”× ×™×§×•×“ ×“×¨×š ×”×§×¨×™×˜×¨×™×•× ×™×)
# =============================================================================
tempo_targets:
  rep_t_s:   [1.2, 4.0]   # ×–××Ÿ ×—×–×¨×” ×›×•×œ×œ
  ecc_s:     [0.8, 3.0]   # ×™×¨×™×“×”
  con_s:     [0.6, 2.5]   # ×¢×œ×™×™×”
  pause_bot: [0.0, 0.8]   # ×¡×˜-××¤ ×§×¦×¨ ××•×ª×¨
  pause_top: [0.30, 1.0]  # ×“×¨×™×©×” ×œ×¢×¦×™×¨×” ×§×¦×¨×” ×œ× ×¢×™×œ×” ××œ××”

# =============================================================================
# ğŸ¦¶ ×× ×— ×¨×’×œ×™×™× (×”×›×•×•× ×”; ×”× ×™×§×•×“ ×“×¨×š ×”×§×¨×™×˜×¨×™×•× ×™×)
# =============================================================================
stance_targets:
  stance_width_ratio: [0.85, 1.15]      # ×§×¨×•×‘-×œ×›×ª×¤×™×™×
  toe_angle_deg:      [5, 20]           # ×¤×™×©×•×Ÿ ×§×œ
  knee_toe_alignment_ok_abs_deg: 5      # |×¡×˜×™×™×”| â‰¤5Â° ×™×¢×“

# =============================================================================
# âš–ï¸ × ×™×§×•×“ (0â€“2) â€” ×”×ª×××•×ª ×œ×•×•×¨×™×× ×˜ ××¢×œ ×”-BASE
# -----------------------------------------------------------------------------
# ×”×“×’×© ×”××‘×•×§×©:
# â€¢ ROM ×–×•×•×™×ª×™: ×’×‘×•×” ×××•×“ (1.9)
# â€¢ ×‘×˜×™×—×•×ª ×¢××•×“-×©×“×¨×” (spine_rounding): ×”×’×‘×•×” ×‘×™×•×ª×¨ (2.0)
# ×©××¨ ×”××©×§×œ×™× ×©××¨× ×™×™× ×›×“×™ ×©×œ× "×™×¢×¤×™×œ×•" ×œ×—×©×™×‘×•×ª ×©×œ ROM/×’×‘.
# =============================================================================
scoring:

  policy:
    missing: skip
    min_criteria_for_full_quality: 3

  criteria:

    # --- ×‘×˜×™×—×•×ª (×”×“×’×©×” "×§×¦×ª ×™×•×ª×¨" ×œ×¢×™×’×•×œ ×’×‘) ---
    spine_rounding:
      weight: 2.0
      rule:
        kind: symmetric_threshold
        input: spine_flexion_deg
        ok:   8     # â‰¤8Â° ××¦×•×™×Ÿ
        warn: 15    # 8â€“15Â° ×‘×™× ×•× ×™
        bad:  25    # â‰¥25Â° ×’×¨×•×¢

    lateral_bend:
      weight: 1.2
      rule:
        kind: symmetric_threshold
        input: spine_curvature_side_deg
        ok:   5
        warn: 10
        bad:  20

    head_spine:
      weight: 1.0
      rule:
        kind: symmetric_threshold
        input: abs(head_pitch_deg - torso_forward_deg)
        ok:   10
        warn: 20
        bad:  30

    # --- ×ª×‘× ×™×ª Hinge (×œ× ×¡×§×•×•××˜) ---
    hinge_posture:
      weight: 1.4
      rule:
        kind: linear_band
        input: torso_forward_deg   # ×”×˜×™×” ×§×“×™××” (×™×—×¡×™×ª ×œ×‘×¨×š ×¤×ª×•×—×”) â€” ××“×“ ×’× ×¨×™
        good_max: 25
        ok_max:   35
        bad_max:  55

    knee_flex_limit:
      weight: 0.8
      rule:
        kind: threshold_window
        input: min(knee_left_deg, knee_right_deg)
        target_min: 100            # "×‘×¨×š ×¤×ª×•×—×”" ×™×—×¡×™×ª (×’×‘×•×”=×¤×ª×•×—)
        cutoff_min:  80
        direction: higher_is_better

    # --- ROM ×–×•×•×™×ª×™ (×”×›×™ ×§×¨×™×˜×™ ××—×¨×™ ×’×‘) ---
    rom_joint:
      weight: 1.9
      rule:
        kind: linear_band
        input: rom_joint_ratio     # min(hip_rom/target_hip, torso_rom/target_torso)
        good_min:   0.95           # 95â€“100% â†’ ×¢×•×œ×” ×œ×™× ×™××¨×™×ª ×¢×“ 1.0 (××™×Ÿ "×§×¤×™×¦×”" ×‘×™×Ÿ 99% ×œ-100%)
        ok_min:     0.50           # 50â€“95% â†’ ×ª×—×•× ×—×œ×§×™/×‘×™× ×•× ×™
        cutoff_min: 0.30           # <0.30 â†’ ×§×¦×¨ ××“×™ (×œ× × ×¡×¤×¨)
        direction: higher_is_better

    # --- ×©×œ×™×˜×”/×§×¦×‘ ---
    phase_control:
      weight: 1.2
      rule:
        kind: tempo_parts_window
        ecc_s: [0.8, 3.0]
        con_s: [0.6, 2.5]
        pause_bottom_s: [0.0, 0.8]
        pause_top_s: [0.0, 1.0]    # × ×™×§×•×“ ×›×œ×œ×™; ×“×¨×™×©×ª × ×¢×™×œ×” ×”××™× ×™××œ×™×ª ×‘××” ×‘××“×™× ×™×•×ª Lockout

    tempo:
      weight: 0.8
      rule:
        kind: tempo_window
        input: rep.timing_s
        min: 1.2
        max: 4.0
        cutoff_min: 0.6
        cutoff_max: 6.0

    # --- ×¢××™×“×”/×¨×’×œ×™×™× ---
    knee_valgus:
      weight: 1.2
      rule:
        kind: symmetric_threshold
        input: max(abs(knee_foot_alignment_left_deg), abs(knee_foot_alignment_right_deg))
        ok:   5
        warn: 10
        bad:  20

    heels_grounded:
      weight: 0.8
      rule:
        kind: boolean_flag
        input: not heels_grounded
        good_when: false
        penalty: 0.30

    stance_width:
      weight: 0.5
      rule:
        kind: band_center
        input: features.stance_width_ratio
        min_ok: 0.85
        max_ok: 1.15
        cutoff_min: 0.70
        cutoff_max: 1.50

    toe_angle:
      weight: 0.4
      rule:
        kind: symmetric_band_pair
        input: (toe_angle_left_deg, toe_angle_right_deg)
        pair_ok_min: 5
        pair_ok_max: 20
        asymmetry_max: 10
        cutoff_total_max: 40

    # --- ××™×›×•×ª ×”×™×¤×•×š ---
    turn_quality:
      weight: 0.5
      rule:
        kind: turn_guard
        min_turn_ms: 100
        jerk_penalty: 0.20

  aggregate:
    method: weighted_mean
    weights_source: inline

  # ×ª×§×¨×•×ª ×‘×˜×™×—×•×ª ××—××™×¨×•×ª ×™×—×¡×™×ª (×œ× ××•×—×§×•×ª ×”×™×©×’×™× ××—×¨×™×, ××‘×œ ××’×‘×™×œ×•×ª)
  safety_caps:
    - when: "spine_rounding <= 0.6"   # ×¢×’×™×œ×” ××•×¨×’×©×ª
      cap: 0.80
    - when: "spine_rounding <= 0.4"   # ×¢×’×™×œ×” ×§×©×”
      cap: 0.70
    - when: "knee_valgus   <= 0.6"
      cap: 0.90
    - when: "heels_grounded <= 0.5"
      cap: 0.90

# =============================================================================
# ğŸ” ×¡×¤×™×¨×ª ×—×–×¨×•×ª / ×©×¢×¨ ×¡×’×™×¨×”
# -----------------------------------------------------------------------------
# ×¡×¤×™×¨×” × ×©×¢× ×ª ×¢×œ ×–×•×•×™×•×ª (ROM ×–×•×•×™×ª×™). ××™×Ÿ "×¢× ×™×©×”" ×¢×œ 99% ××•×œ 100% â€” ×”××¢×‘×¨ ×—×œ×§.
# =============================================================================
rep_counting:
  thresholds:
    min_rom_partial: 0.30
    min_rom_good:    0.50
    min_rep_ms:      500
    max_rep_ms:      6000
    min_turn_ms:     100
  signals:
    prefer_angles: true
    use_object_y_as_aux: true

# =============================================================================
# âœ… ××“×™× ×™×•×ª × ×¢×™×œ×” (Full Lockout) â€” ××›×¤×™×œ×™ ×¦×™×•×Ÿ ×¨×›×™×
# -----------------------------------------------------------------------------
# ×“×¨×™×©×ª ×¢×¦×™×¨×” ×§×¦×¨×” ×œ××¢×œ×” ×›×“×™ ×œ××©×¨ "× ×¢×™×œ×” ××œ××”" ×•×œ×”×‘×“×™×œ ×××§×¨×™ ××××¥ ×œ×œ× ×¡×’×™×¨×”.
# ×”×¤×¢×¨ ×‘×™×Ÿ FULL ×œ-ALMOST ×’×“×•×œ, ×›×“×™ ×œ×”×“×’×™×© ××ª ×—×©×™×‘×•×ª ×”× ×¢×™×œ×” ×‘×“×“×œ×™×¤×˜.
# =============================================================================
policy:
  lockout:
    full:
      hold_s_min: 0.30
      spine_max_deg: 10
      head_line_max_deg: 10
      torso_forward_top_max_deg: 15
      heels_ok: true
      multiplier: 1.00
    almost:
      hold_s_min: 0.15
      spine_max_deg: 10
      head_line_max_deg: 10
      heels_ok: true
      multiplier: 0.65     # ×¤×¢×¨ ××©××¢×•×ª×™ ×-1.00
    clean_no_hold:
      hold_s_min: 0.00
      spine_max_deg: 10
      head_line_max_deg: 10
      heels_ok: true
      multiplier: 0.50
    bad:
      multiplier: 0.30

  # ×©××™×¨×” ××¤× ×™ "×”×—×¨×¤×ª ×’×‘" ×‘×ª×—×ª×™×ª (Guard ×“×™× ××™):
  guards:
    spine_bottom_worsening:
      compare: "spine_flexion_deg@bottom - spine_flexion_deg@setup"
      threshold_deg: 8           # ×× ×”×—×¨×¤×” â‰¥8Â°, ××¤×—×™×ª×™× ×‘××¢×˜
      multiplier_on_rep: 0.90

# =============================================================================
# ğŸ§® ×¤×•×¡×˜-×¢×™×‘×•×“ ×¦×™×•×Ÿ (Rep)
# -----------------------------------------------------------------------------
# ×¦×™×•×Ÿ ×¡×•×¤×™ = ×¦×™×•×Ÿ ×œ×™×‘×” (××—×¨×™ safety_caps) Ã— ××›×¤×™×œ × ×¢×™×œ×”
# =============================================================================
post:
  apply_lockout_policy: true

# =============================================================================
# ğŸ“£ ×—×™×•×•×˜ ××©×¤×˜×™× (phrases)
# =============================================================================
phrases:
  namespace: "hinge.conventional"
  lockout_map:
    full:          "hinge.conventional.lockout.rep_full"
    almost:        "hinge.conventional.lockout.rep_almost"
    clean_no_hold: "hinge.conventional.lockout.rep_no_hold_clean"
    bad:           "hinge.conventional.lockout.rep_bad"
  set_map:
    last_rep_no_full_lockout: "hinge.conventional.set.last_rep_no_full_lockout"
  inherit_common_maps: true  # hinge.common.* (ROM/Turn/Path ×•×›×•')

# =============================================================================
# ğŸ§ª ×‘×“×™×§×•×ª ××•××œ×¦×•×ª (QA)
# =============================================================================
qa_notes:
  - "×”×©×•×•×” ×¡×˜ ×¢× pause_topâ‰ˆ0.35s ××•×œ ×¡×˜ ×¢× 0.20s: ×”×¦×™×•×Ÿ ×¦×¨×™×š ×œ×”×™×•×ª 1.00 ××•×œ 0.65~."
  - "×‘×“×•×§ ×©×—×–×¨×” 0.49 ROM ×œ× × ×¡×¤×¨×ª, 0.55 × ×¡×¤×¨×ª ×›×˜×•×‘×” (×‘×”× ×—×” ×©×”×©××¨ ×ª×§×™×Ÿ)."
  - "×•×•×“× ×©××™×Ÿ ×§×¤×™×¦×” ×‘×™×Ÿ 0.99 ×œ-1.00 ×‘-ROM (××¢×‘×¨ ×œ×™× ×™××¨×™ ×—×œ×§)."
  - "×‘×“×•×§ ×©×”cap ×©×œ spine_rounding ××•×¤×¢×œ ×›×©×¢×’×™×œ×” ×§×©×”, ×’× ×× ×©××¨ ×”××“×“×™× ×’×‘×•×”×™×."
  - "×‘×“×•×§ ×©×”-guard spine_bottom_worsening ××¤×—×™×ª ××¢×˜ ×›×©×‘×ª×—×ª×™×ª ×™×© ×”×—×¨×¤×” ×‘×™×—×¡ ×œ-setup."

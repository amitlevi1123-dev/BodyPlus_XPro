# =============================================================================
# deadlift.barbell.conventional.yaml — דדליפט רגיל עם מוט (Conventional Barbell)
# נתיב מומלץ: exercises/packs/hinge/barbell/deadlift.barbell.conventional.yaml
# -----------------------------------------------------------------------------
# מה מייחד את הווריאנט?
# • ציוד: מוט (barbell)
# • מצב פתיחה: from_floor — התחלה מהרצפה
# • ROM זוויתי (ירך/גו) עם יעדי וריאנט מעט קשיחים מהבסיס
# • מדיניות Top: full_lockout → ציון מלא רק אם בוצעה נעילה מלאה + עצירה קצרה (≈0.30s)
# • עומד על תבנית Hinge (לא סקוואט), יישור ברך-כף רגל, עקבים נעוצים.
# =============================================================================

meta:
  id: "deadlift.barbell.conventional"
  family: "hinge"
  display_name: "Deadlift — Barbell (Conventional)"
  selectable: true
  version: 1.0.0

  # הווריאנט דורש נעילה מלאה; ה-base רק מספק hook למדיניות Top
  lockout_mode: "full_lockout"

  # מצב פתיחה: מהרצפה (מכתיב את סדר הפאזות ומטרות ה-ROM בבסיס)
  start_mode: "from_floor"

  # ציוד מזוהה
  equipment: "barbell"

  notes: >
    דדליפט קונבנציונלי מהמוט על הרצפה. הדגשים: גב ניטרלי לאורך כל הטווח,
    יחס Hinge ברור (גו מוטה קדימה וברך פתוחה יחסית), הרמה חלקה, ונעילה מלאה
    עם עצירה קצרה בעמידה כדי לאשר סגירת חזרה. ה-ROM מחושב מזוויות (Hip/Torso),
    והספירה/פאזות מגובות ב-object_y רק כעזר (אם זמין).

# =============================================================================
# 🧭 רמזים למסווג (Classifier Hints)
# -----------------------------------------------------------------------------
# עוזרים לבחור את הווריאנט הנכון בתוך משפחת hinge:
# - חייבים זיהוי פוזה
# - עדיפות לזהוי מוט ולעובדה שהציוד הוא barbell
# - זוויות צילום מועדפות: צד/אלכסון קדמי
# =============================================================================
match_hints:
  must_have: [pose.available]
  any_of: [objdet.bar_present, objdet.object_present]
  ranges:
    objdet.object_kind: ["barbell"]     # מצפים למוט
  pose_view: ["side", "front_left", "front_right"]
  motion_pattern: ["hip_hinge"]
  joints_focus: ["hips", "spine", "knees"]
  weight: 1.0

# =============================================================================
# 🎯 התאמות יעדים לווריאנט
# -----------------------------------------------------------------------------
# יעדי ROM זוויתיים מעט קשיחים יותר מהברירת-מחדל המשפחתית.
# =============================================================================
targets:
  from_floor:
    hip_deg:   62      # יעד ROM בירך (מינימום לשקלול מלא)
    torso_deg: 36      # יעד ROM בגו

# =============================================================================
# ⏱️ מטרות טמפו ושליטה בפאזות (Guidelines)
# -----------------------------------------------------------------------------
# לא חוקים קשיחים אלא חלונות מועדפים. הניקוד מתבצע דרך הקריטריונים ב-base.
# =============================================================================
tempo_targets:
  rep_t_s:   [1.2, 4.0]   # זמן חזרה כולל
  ecc_s:     [0.8, 3.0]   # ירידה
  con_s:     [0.6, 2.5]   # עלייה
  pause_bot: [0.0, 0.8]   # סט-אפ קצר מותר בתחתית
  pause_top: [0.30, 1.0]  # דרושה עצירה קצרה ≥0.30s לנעילה מלאה

# =============================================================================
# 🦶 מנח רגליים (Guidelines)
# -----------------------------------------------------------------------------
# חלונות מועדפים לרוחב עמידה, זווית כפות רגליים ויישור ברך-כף רגל.
# =============================================================================
stance_targets:
  stance_width_ratio: [0.85, 1.15]      # קרוב-לכתפיים
  toe_angle_deg:      [5, 20]           # פישון קל
  knee_toe_alignment_ok_abs_deg: 5      # |סטייה| ≤ 5° יעד

# =============================================================================
# 🔁 רמזי ספירה/פאזות (Overrides עדינים)
# -----------------------------------------------------------------------------
# ה-ROM והפאזות מזוהים מזוויות (Hip/Torso). object_y רק כעזר למגע/מסלול.
# =============================================================================
rep_detection_hints:
  prefer_angles: true                 # זיהוי turn והתקדמות מזוויות
  use_object_y_as_aux: true           # עזר למגע רצפה/מסלול אנכי אם זמין

# =============================================================================
# ✅ מדיניות Top ספציפית לווריאנט — Full Lockout
# -----------------------------------------------------------------------------
# מכפילים רכים לציון החזרה (אחרי weighted_mean וה-Safety Caps מה-base).
# העיקרון: ציון מלא רק עם נעילה מלאה + עצירה קצרה; אחרת ציון מופחת יחסי.
# =============================================================================
policy:
  lockout:
    # תנאים לנעילה מלאה (OK מלא):
    full:
      hold_s_min: 0.30                 # עצירה קצרה למעלה לאימות עמידה
      spine_max_deg: 10                # גב ניטרלי
      head_line_max_deg: 10            # |head_pitch - torso_forward|
      torso_forward_top_max_deg: 15    # גו כמעט זקוף
      heels_ok: true
      multiplier: 1.00                 # בלי הורדה

    # כמעט-נעילה (עצירה 0.15–0.29s, שאר תנאים תקינים)
    almost:
      hold_s_min: 0.15
      spine_max_deg: 10
      head_line_max_deg: 10
      heels_ok: true
      multiplier: 0.92

    # אין עצירה למעלה, אך היציבה בטופ תקינה
    clean_no_hold:
      hold_s_min: 0.00
      spine_max_deg: 10
      head_line_max_deg: 10
      heels_ok: true
      multiplier: 0.85

    # בעיות בטיחות/יציבה בטופ (גב עגול, ראש לא בקו, עקבים עולים)
    bad:
      multiplier: 0.70

# =============================================================================
# 🧮 פוסט-עיבוד ציון ברמת חזרה
# -----------------------------------------------------------------------------
# המנוע יחיל את מכפילי ה-Lockout על ציון הליבה (rep_score_core) שמגיע מה-base:
# rep_score = rep_score_core * lockout_multiplier
# (rep_score_core כבר כולל Safety Caps לפי spine/knee וכו')
# =============================================================================
post:
  apply_lockout_policy: true

# =============================================================================
# 📣 פידבק סט — דגל לחזרה אחרונה לא סגורה
# -----------------------------------------------------------------------------
# אם החזרה האחרונה לא עמדה במדיניות full_lockout → התרעה ברמת הסט.
# הטקסטים עצמם יגיעו מקובץ phrases (תוסיף בהמשך).
# =============================================================================
set_feedback:
  last_rep_needs_lockout_alert: true
  last_rep_text_code: "set.last_rep_no_full_lockout"   # מזהה שיופיע ב-phrases.yaml

# =============================================================================
# 🧪 בדיקות מומלצות (תיעודי)
# -----------------------------------------------------------------------------
# 1) סט עם עצירה קצרה בטופ → לוודא שאין הורדה.
# 2) סט בלי עצירה → לראות הורדה מתונה (multiplier 0.85).
# 3) אחרונה בכוונה בלי נעילה → תופיע התראת סט.
# 4) ROM זוויתי מזהה עומק תקין גם כשזום/מרחק משתנים.
# =============================================================================
qa_notes:
  - "בדוק ספירה מזוויות גם ללא object_y (ללא תלות בציוד)."
  - "בדוק knee_toe_alignment לא חורג מ-±5°."
  - "ודא spine_flexion נמוך לאורך כל החזרה (ניטרלי)."
  - "בדוק שאין bounce בקרקע (turn_quality)."

# =============================================================================
# deadlift.barbell.conventional.yaml — דדליפט רגיל עם מוט (Conventional Barbell)
# נתיב: exercises/packs/hinge/barbell/deadlift.barbell.conventional.yaml
# -----------------------------------------------------------------------------
# מייחד הווריאנט:
# • ציוד: מוט (barbell)
# • מצב פתיחה: from_floor — התחלה מהרצפה
# • ROM זוויתי (ירך/גו) עם יעדי וריאנט מעט קשיחים מהבסיס
# • Top Policy: full_lockout — ציון מלא רק אם יש נעילה מלאה + עצירה קצרה (≥0.30s)
# • תבנית Hinge (לא סקוואט), יישור ברך–כף-רגל, עקבים נעוצים.
# =============================================================================

meta:
  id: "deadlift.barbell.conventional"
  family: "hinge"
  display_name: "Deadlift — Barbell (Conventional)"
  selectable: true
  version: 1.0.0

  # הווריאנט דורש נעילה מלאה; ה-base מספק hooks למדיניות Top
  lockout_mode: "full_lockout"

  # מצב פתיחה: מהרצפה (מכתיב פאזות ויעדי ROM מתוך ה-base)
  start_mode: "from_floor"

  # ציוד מזוהה
  equipment: "barbell"

  notes: >
    דדליפט קונבנציונלי מהמוט על הרצפה. דגשים: גב ניטרלי לאורך כל התנועה,
    יחס Hinge ברור (גו מוטה קדימה וברך פתוחה יחסית), הרמה חלקה, ונעילה מלאה
    עם עצירה קצרה בעמידה כדי לאשר סגירת חזרה. ה-ROM מחושב מזוויות (Hip/Torso);
    object_y משמש עזר בלבד למסלול/מגע אם זמין.

# =============================================================================
# 🧭 רמזים למסווג (Classifier Hints)
# -----------------------------------------------------------------------------
# עוזרים לבחור את הווריאנט הנכון בתוך משפחת hinge:
# - חייבים זיהוי פוזה
# - עדיפות לזיהוי מוט ולעובדה שהציוד הוא barbell
# - זוויות צילום מועדפות: צד/אלכסון קדמי
# =============================================================================
match_hints:
  must_have: [pose.available]
  any_of: [objdet.bar_present, objdet.object_present]
  ranges:
    objdet.object_kind: ["barbell"]     # מצפים למוט
  pose_view: ["side", "front_left", "front_right"]
  motion_pattern: ["hip_hinge"]
  joints_focus: ["hips", "spine", "knees"]
  weight: 1.0

# =============================================================================
# 🎯 התאמות יעדי ROM לווריאנט (מעל ה-base)
# =============================================================================
targets:
  from_floor:
    hip_deg:   62      # יעד ROM בירך (מינימום לשקלול מלא)
    torso_deg: 36      # יעד ROM בגו

# =============================================================================
# ⏱️ חלונות טמפו והחזקה (Guidelines)
# -----------------------------------------------------------------------------
# אלה חלונות מועדפים — הניקוד מתבצע דרך הקריטריונים ב-base.
# =============================================================================
tempo_targets:
  rep_t_s:   [1.2, 4.0]   # זמן חזרה כולל
  ecc_s:     [0.8, 3.0]   # ירידה
  con_s:     [0.6, 2.5]   # עלייה
  pause_bot: [0.0, 0.8]   # סט-אפ קצר מותר בתחתית
  pause_top: [0.30, 1.0]  # דרושה עצירה קצרה ≥0.30s לנעילה מלאה

# =============================================================================
# 🦶 מנח רגליים (Guidelines)
# =============================================================================
stance_targets:
  stance_width_ratio: [0.85, 1.15]      # קרוב-לכתפיים
  toe_angle_deg:      [5, 20]           # פישון קל
  knee_toe_alignment_ok_abs_deg: 5      # |סטייה| ≤ 5° יעד

# =============================================================================
# 🔁 העדפות זיהוי חזרות/פאזות
# -----------------------------------------------------------------------------
# ה-ROM והפאזות מזוהים מזוויות (Hip/Torso). object_y עזר למגע/מסלול בלבד.
# =============================================================================
rep_detection_hints:
  prefer_angles: true
  use_object_y_as_aux: true

# =============================================================================
# ✅ מדיניות Top ספציפית — Full Lockout
# -----------------------------------------------------------------------------
# מכפילים רכים החלים על ציון הליבה (אחרי weighted_mean + Safety Caps מה-base).
# עיקרון: ציון מלא רק עם נעילה מלאה + עצירה קצרה; אחרת ציון מופחת יחסית.
# =============================================================================
policy:
  lockout:
    full:
      hold_s_min: 0.30                 # עצירה קצרה לאימות עמידה מלאה
      spine_max_deg: 10                # גב ניטרלי
      head_line_max_deg: 10            # |head_pitch - torso_forward|
      torso_forward_top_max_deg: 15    # גו כמעט זקוף
      heels_ok: true
      multiplier: 1.00
    almost:
      hold_s_min: 0.15
      spine_max_deg: 10
      head_line_max_deg: 10
      heels_ok: true
      multiplier: 0.92
    clean_no_hold:
      hold_s_min: 0.00
      spine_max_deg: 10
      head_line_max_deg: 10
      heels_ok: true
      multiplier: 0.85
    bad:
      multiplier: 0.70

# =============================================================================
# 🧮 פוסט-עיבוד ציון (Rep)
# -----------------------------------------------------------------------------
# rep_score = rep_score_core * lockout_multiplier
# (rep_score_core כבר כולל תקרות בטיחות לפי spine/knee וכו')
# =============================================================================
post:
  apply_lockout_policy: true

# =============================================================================
# 📣 חיווט משפטים (phrases) — ייעודי לווריאנט
# -----------------------------------------------------------------------------
# מצביעים למרחב המותאם ב-phrases.yaml: hinge.conventional.*
# =============================================================================
phrases:
  namespace: "hinge.conventional"

  lockout_map:
    full:          "hinge.conventional.lockout.rep_full"
    almost:        "hinge.conventional.lockout.rep_almost"
    clean_no_hold: "hinge.conventional.lockout.rep_no_hold_clean"
    bad:           "hinge.conventional.lockout.rep_bad"

  set_map:
    last_rep_no_full_lockout: "hinge.conventional.set.last_rep_no_full_lockout"

  # ירושה של מפות ROM/Turn/Path מה-base (hinge.common.*)
  inherit_common_maps: true

# =============================================================================
# 🧪 בדיקות מומלצות (תיעודי)
# =============================================================================
qa_notes:
  - "השווה סט עם החזקת ≥0.30s בטופ מול סט ללא עצירה — המולטי אמור להיות 1.00 לעומת 0.85/0.92."
  - "ודא שספירה עומדת על ROM מזוויות גם ללא object_y."
  - "בדוק knee_toe_alignment לא חורג מ-±5°."
  - "ודא spine_flexion נמוך לאורך כל החזרה (ניטרלי)."
  - "בדוק שאין bounce בקרקע — turn צריך להיות חלק."

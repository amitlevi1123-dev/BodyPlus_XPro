# -------------------------------------------------------------------
# squat_barbell.yaml â€” ×¡×§×•×•××˜ ×¢× ××•×˜ (Barbell Squat)
# -------------------------------------------------------------------
# ×§×•×‘×¥ ×ª×¨×’×™×œ ××‘×•×¡×¡ ×¨××™×•×ª: ×¡×¤×™ ×¢×•××§ ×¡×‘×™×‘ 90Â°, ×˜×•×•×—×™ ×–×•×•×™×•×ª ×¨×’×œ×™×™×
# 8â€“20Â°, ×“×’×© ×‘×˜×™×—×•×ª×™ ×›×‘×“ ×¢×œ ×¢×’×™×œ×ª ×’×‘/×•×œ×’×•×¡/×¢×™×§×•× ×¦×“×“×™, ×•×¢×§×‘×™× × ×¢×•×¦×™×.
# ×™×•×¨×© ××ª ××“×™× ×™×•×ª ×”-scoring ×•×”-Caps ×-squat.base.
# -------------------------------------------------------------------

id: squat.barbell
family: squat
extends: squat.base

meta:
  selectable: true
  display_name: "×¡×§×•×•××˜ ×¢× ××•×˜"
  description: "×¡×§×•×•××˜ ×¢× ××•×˜ â€” ×¢×•××§ ×¡×‘×™×‘ 90Â°, ×¢×§×‘×™× × ×¢×•×¦×™×, ×§×¦×‘ × ×©×œ×˜ ×•×‘×˜×™×—×•×ª ×’×‘/×‘×¨×›×™×™×."
  equipment: "××•×˜"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ×”×ª×××•×ª scoring ×™×™×¢×•×“×™×•×ª ×œ×‘×¨×‘×œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
scoring:
  policy:
    missing: skip
    min_criteria_for_full_quality: 3

  criteria:

    # ğŸ›¡ï¸ ×‘×˜×™×—×•×ª â€” ××©×§×œ×™× ×’×‘×•×”×™× (×™×•×¨×©×™× ××”-base ××ª ×”×©××•×ª ×”×œ×•×’×™×™×)
    spine_rounding:
      weight: 2.2
      rule:
        kind: linear_band
        input: spine_flexion_deg
        good_max: 10      # â‰¤10Â° ××¦×•×™×Ÿ
        ok_max:   20      # 10â€“20Â° ×‘×™× ×•× ×™
        bad_max:  35      # â‰¥35Â° ×’×¨×•×¢

    knee_valgus:
      weight: 2.0
      rule:
        kind: symmetric_threshold
        input: "max(abs(knee_foot_alignment_left_deg), abs(knee_foot_alignment_right_deg))"
        ok:   5           # â‰¤5Â° ×˜×•×‘
        warn: 10          # 5â€“10Â° ×‘×™× ×•× ×™
        bad:  20          # â‰¥20Â° ×’×¨×•×¢

    spine_sidebend:
      weight: 1.5
      rule:
        kind: symmetric_threshold
        input: spine_curvature_side_deg
        ok:   5
        warn: 10
        bad:  20

    # âš™ï¸ ×˜×›× ×™×§×”
    depth:
      weight: 1.2
      rule:
        kind: threshold_window
        input: "min(knee_left_deg, knee_right_deg)"
        target_max: 90    # â‰¤90Â° = 1.0
        cutoff_max: 150   # â‰¥150Â° = 0.0
        direction: lower_is_better

    tempo:
      weight: 0.6
      rule:
        kind: tempo_window
        input: rep.timing_s
        min: 0.8          # ××™×˜×™ ×××©×§×œ ×’×•×£/×“×××‘×œ ×œ×©××™×¨×ª ×©×œ×™×˜×”
        max: 3.0
        cutoff_min: 0.5
        cutoff_max: 4.5

    stance_width:
      weight: 0.8
      rule:
        kind: band_center
        input: features.stance_width_ratio
        min_ok: 0.90      # ~×¨×•×—×‘ ×›×ª×¤×™×™× (0.9â€“1.2Ã—)
        max_ok: 1.20
        cutoff_min: 0.70
        cutoff_max: 1.50

    foot_angle:
      weight: 0.7
      rule:
        kind: band_center
        input: "mean(abs(toe_angle_left_deg), abs(toe_angle_right_deg))"
        min_ok: 8         # 8â€“20Â° ×”×—×•×¦×”
        max_ok: 20
        cutoff_min: 0
        cutoff_max: 30

    head_alignment:
      weight: 0.8
      rule:
        kind: symmetric_threshold
        input: "abs(head_pitch_deg - spine_flexion_deg)"
        ok:   10          # ×¦×•×•××¨ ×‘×§×• ×¢× ×¢××•×“ ×”×©×“×¨×” (Â±10Â°)
        warn: 20
        bad:  30

    heels_grounded:
      weight: 0.8
      rule:
        kind: boolean_flag
        input: "max(heel_lift_left, heel_lift_right)"  # 0=× ×¢×•×¥, 1=××•×¨×
        true_score: 0.5
        false_score: 1.0

  # ×ª×§×¨×•×ª ×‘×˜×™×—×•×ª â€” × ×©××¨×•×ª ×›××• ×‘××©×¤×—×”
  safety_caps:
    - { when: "spine_rounding <= 0.6", cap: 0.70 }
    - { when: "knee_valgus   <= 0.6", cap: 0.75 }
    - { when: "spine_sidebend<= 0.6", cap: 0.80 }

  aggregate:
    method: weighted_mean
    weights_source: inline

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ×¨××–×™ ×–×™×”×•×™ (Auto-Detection)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
match_hints:
  must_have:     [pose.available, objdet.bar_present]
  must_not_have: [objdet.dumbbell_present, objdet.kettlebell_present]
  pose_view:     ["front", "front_left", "front_right"]
  motion_pattern:["hip_down", "knee_flexion"]
  joints_focus:  ["hips", "knees", "spine"]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ×¡×¤×™×¨×ª ×—×–×¨×•×ª (Rep Signal)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rep_signal:
  source: "value|min|hip_y_px"
  thresholds:
    min_rom_good: 60
    min_rep_ms:   500
    max_rep_ms:   7000

# -------------------------------------------------------------------
# ×”×¢×¨×•×ª ×™×™×©×•× (×ª××¦×™×ª):
# â€¢ ×¢×•××§: ×¦×™×•×Ÿ ×¢×•×œ×” ×œ×™× ×™××¨×™×ª ×¢×“ 90Â° ×‘×¨×š ×•× ×¢×¦×¨ ×©× (×œ× ××ª×’××œ ××¢×‘×¨ ×œ×›×š).
# â€¢ ×‘×˜×™×—×•×ª: spine/knee/sidebend ×¢× ××©×§×œ ×’×‘×•×” ×•×ª×§×¨×•×ª cap ×‘××§×¨×” ×’×¨×•×¢.
# â€¢ ×¢×§×‘×™×: ×“×’×œ ×¨×š ××š ××©××¢×•×ª×™; ×©××™×¨×” ×¢×œ ××’×¢ ××œ× ×¢×“×™×¤×” ×ª×—×ª ×¢×•××¡.
# â€¢ ×¦×•×•××¨: ×™×™×©×•×¨ ×¢× ×¢××•×“ ×”×©×“×¨×” ××¤×—×™×ª ×¢×•××¡×™× ×’×–×¢×™×™× (Â±10Â° ×™×¢×“).
# â€¢ × ×˜×™×™×ª ×’×• (torso_forward_deg): ×œ×¤×™×“×‘×§ ×‘×œ×‘×“ â€” ×œ× ×¢× ×™×©×” ×›×©×œ×¢×¦××”.
# -------------------------------------------------------------------

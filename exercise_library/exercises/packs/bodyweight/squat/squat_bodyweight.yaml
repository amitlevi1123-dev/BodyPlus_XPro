# -------------------------------------------------------------------
# squat_bodyweight.yaml — סקוואט משקל גוף (Bodyweight Squat)
# -------------------------------------------------------------------
# תרגיל זה מיועד לביצוע ללא ציוד. המזהה האוטומטי יבחר בו כאשר
# לא מזוהה מוט/דאמבל/ציוד (ראו match_hints.must_not_have).
# -------------------------------------------------------------------

id: squat.bodyweight
family: squat
extends: squat.base

meta:
  selectable: true
  display_name: "סקוואט משקל גוף"
  description: "סקוואט קלאסי ללא ציוד — בודק שליטה, עומק ובטיחות בתנועה טבעית."
  equipment: "ללא ציוד"   # שדה מידע לממשק/דוחות (לא מחייב את המנוע)

# ───── התאמות ייחודיות לתרגיל (יורש את כל השאר מה־base) ─────
scoring:
  criteria:

    # עומק — במשקל גוף מותר לשאוף מעט עמוק יותר עד ~85° ברך לציון מלא
    depth:
      weight: 1.3
      rule:
        kind: threshold_window
        input: "min(knee_left_deg, knee_right_deg)"
        target_max: 85          # ≤85° = 1.0
        cutoff_max: 150         # ≥150° = 0.0
        direction: lower_is_better

    # קצב — חזרות נטו להיות מעט זריזות יותר
    tempo:
      weight: 0.5
      rule:
        kind: tempo_window
        input: rep.timing_s
        min: 0.6
        max: 2.0
        cutoff_min: 0.3
        cutoff_max: 3.0

    # רוחב עמידה — סובלנות רחבה יותר למבני גוף שונים
    stance_width:
      weight: 0.8
      rule:
        kind: band_center
        input: features.stance_width_ratio
        min_ok: 0.85
        max_ok: 1.25
        cutoff_min: 0.65
        cutoff_max: 1.55

    # עקבים נעוצים — חשוב במיוחד ללא ציוד
    heels_grounded:
      weight: 0.8
      rule:
        kind: boolean_flag
        input: "max(heel_lift_left, heel_lift_right)"  # 0=נעוץ, 1=מורם
        true_score: 0.5        # אם יש הרמת עקב → ציון הקריטריון 0.5
        false_score: 1.0       # אם אין → 1.0

  # תקרות בטיחות — יורש/משמר מה־base (מצויין כאן לנוחות קריאה)
  safety_caps:
    - { when: "spine_rounding <= 0.6", cap: 0.70 }
    - { when: "knee_valgus   <= 0.6", cap: 0.75 }
    - { when: "spine_sidebend<= 0.6", cap: 0.80 }

# ───── רמזים לזיהוי תרגיל (Auto-Detection) ─────
# חשוב: זיהוי "ללא ציוד" נעשה כאן — לא בקובץ המשפחה!
match_hints:
  must_have: [pose.available]
  must_not_have: [objdet.bar_present]   # אם אין מוט/ציוד מזוהה → זה Bodyweight
  pose_view: ["front", "front_left", "front_right"]
  motion_pattern: ["hip_down", "knee_flexion"]
  joints_focus: ["hips", "knees", "spine"]

# ───── הגדרות ספירת חזרות ─────
rep_signal:
  source: "value|min|hip_y_px"
  thresholds:
    min_rom_good: 60
    min_rep_ms: 400
    max_rep_ms: 6000

# -------------------------------------------------------------------
# הסבר למפתחים:
# - התרגיל יורש מ־squat.base את כל מדדי הבטיחות (עגילת גב/ולגוס/עיקום צדדי)
#   ואת לוגיקת הניקוד הכללית, ומבצע כאן עדינות לערכי עומק/קצב/רוחב/עקבים.
# - "ללא ציוד" נאכף לוגית על־ידי match_hints.must_not_have: [objdet.bar_present].
#   אם בעתיד יתווספו גלאים לדאמבלים/קטלבל, יש להרחיב רשימה זו בהתאם.
# - עומק עד 85° בברך מקבל ציון מלא; עומק מעבר לכך לא מוסיף ציון נוסף.
# - עקבים שטוחים על הקרקע מודגשים כאן במשקל 0.8, כיוון שיציבות כף רגל קריטית
#   ללא עוגן של משקולת.
# -------------------------------------------------------------------

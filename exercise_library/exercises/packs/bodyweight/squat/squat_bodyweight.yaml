# -------------------------------------------------------------------
# squat.bodyweight.yaml â€” ×¡×§×•×•××˜ ××©×§×œ ×’×•×£ (Bodyweight Squat)
# -------------------------------------------------------------------
# ×™×•×¨×© ××ª ×—×•×§×™ ×”×¡×§×•×•××˜ ×”×‘×¡×™×¡×™×™× ×-squat.base, ×¢× ×”×ª×××•×ª ×œ×¢×•××§/×˜××¤×•/×¢××™×“×”.
# ×“×¨×™×©×” ×¢×™×§×¨×™×ª: ×¢×•××§ ××œ× â€” ×‘×¨×š â‰¤ 90Â°; ×˜××¤×• ××™×˜×™ ×•××‘×•×§×¨ 2.0â€“5.0 ×©× ×™×•×ª.
# -------------------------------------------------------------------

id: squat.bodyweight
family: squat
extends: squat.base

meta:
  selectable: true
  display_name: "×¡×§×•×•××˜ ××©×§×œ ×’×•×£"
  description: "×¡×§×•×•××˜ ×œ×œ× ×¦×™×•×“ â€” ×¢×•××§ ××œ× (â‰¤90Â°), ×¢×§×‘×™× × ×¢×•×¦×™×, ×•×˜××¤×• ××™×˜×™ 2â€“5 ×©× ×™×•×ª."
  equipment: "none"   # ×‘×× ×’×œ×™×ª â€” ×œ×–×™×”×•×™ ×•×¨×™×× ×˜ ×œ×œ× ×¦×™×•×“

# -------------------------------------------------------------------
# âš ï¸ ×§×¨×™×˜×™×™× (×—×•×‘×” ×œ××“×™×“×” ×œ×¦×•×¨×š × ×™×§×•×“ ×—×–×¨×”)
# -------------------------------------------------------------------
# ×× ××—×“ ×”×§×¨×™×˜×¨×™×•× ×™× ×”×œ×œ×• ×—×¡×¨ â†’ policy.missing=skip ×™×“×œ×’ ×¢×œ ×”×—×–×¨×”.
critical: [spine_rounding, knee_valgus, depth]

# -------------------------------------------------------------------
# âš–ï¸ ×”×ª×××•×ª × ×™×§×•×“ (Scoring Overrides)
# -------------------------------------------------------------------
scoring:
  policy:
    missing: skip
    min_criteria_for_full_quality: 3

  criteria:

    # --- ×¢×•××§ (×—×•×‘×” â‰¤ 90Â° ×œ×¦×™×•×Ÿ ××œ×) ---
    depth:
      weight: 1.3
      rule:
        kind: threshold_window
        input: "min(knee_left_deg, knee_right_deg)"
        target_max: 90          # â‰¤90Â° = 1.0
        cutoff_max: 150         # â‰¥150Â° = 0.0
        direction: lower_is_better

    # --- ×˜××¤×• ××™×˜×™ ×•××‘×•×§×¨ ---
    tempo:
      weight: 1.3               # ×”×¢×œ××ª ××©×§×œ ×”×˜××¤×•
      rule:
        kind: tempo_window
        input: rep.timing_s
        min: 2.0                # ×“×¨×™×©×ª ××™× ×™××•× ×—×“×©×”: 2.0s
        max: 5.0
        cutoff_min: 1.3         # ××ª×—×ª ×œ-1.3s × ×¢× ×© ×—×–×§ (×’×‘×•×œ×™)
        cutoff_max: 6.0         # ××¢×œ 6.0s × ×•×¤×œ ×œ×¦×™×•×Ÿ 0

    # --- ×¨×•×—×‘ ×¢××™×“×” (×™×—×¡ ×œ×¨×•×—×‘ ×›×ª×¤×™×™×) ---
    stance_width:
      weight: 0.8
      rule:
        kind: band_center
        input: features.stance_width_ratio
        min_ok: 0.85
        max_ok: 1.25
        cutoff_min: 0.65
        cutoff_max: 1.55

    # --- ×¢×§×‘×™× × ×¢×•×¦×™× (×‘×™× ××¨×™) ---
    heels_grounded:
      weight: 0.8
      rule:
        kind: boolean_flag
        input: "(heel_lift_left or heel_lift_right)"   # True = ×™×© ×”×¨××ª ×¢×§×‘
        good_when: false                                # False = ×¢×§×‘×™× × ×¢×•×¦×™× (×˜×•×‘)
        penalty: 0.50                                   # ×”×•×¨×“×” ×©×œ 50% ×œ×§×¨×™×˜×¨×™×•×Ÿ

    # --- ×‘×˜×™×—×•×ª (×™×•×¨×© ×©××•×ª ××”-base; × ×©××¨×™× ×¤×¢×™×œ×™× ×‘×•×•×¨×™×× ×˜) ---
    spine_rounding:
      weight: 2.0
      rule:
        kind: linear_band
        input: spine_flexion_deg
        good_max: 10
        ok_max:   20
        bad_max:  35

    knee_valgus:
      weight: 2.0
      rule:
        kind: symmetric_threshold
        input: "max(abs(knee_foot_alignment_left_deg), abs(knee_foot_alignment_right_deg))"
        ok:   5
        warn: 10
        bad:  20

    spine_sidebend:
      weight: 1.5
      rule:
        kind: symmetric_threshold
        input: "abs(spine_curvature_side_deg)"
        ok:   5
        warn: 10
        bad:  20

    head_alignment:
      weight: 0.8
      rule:
        kind: symmetric_threshold
        input: "abs(head_pitch_deg - spine_flexion_deg)"
        ok:   10
        warn: 20
        bad:  30

  aggregate:
    method: weighted_mean
    weights_source: inline

  # -----------------------------------------------------------------
  # ×ª×§×¨×•×ª ×‘×˜×™×—×•×ª (Safety Caps) â€” ××’×‘×™×œ×•×ª ×¦×™×•×Ÿ ×—×–×¨×” ×‘××¦×‘ ×¡×™×›×•×Ÿ
  # -----------------------------------------------------------------
  safety_caps:
    - { when: "spine_rounding <= 0.6", cap: 0.70 }   # ×’×‘ ××ª×¢×’×œ â‡’ cap 70%
    - { when: "knee_valgus   <= 0.6", cap: 0.75 }    # ×§×¨×™×¡×ª ×‘×¨×š â‡’ cap 75%
    - { when: "spine_sidebend<= 0.6", cap: 0.80 }    # ×¢×™×§×•× ×¦×“×“×™ â‡’ cap 80%

# -------------------------------------------------------------------
# ğŸ§­ ×¨××–×™× ×œ×–×™×”×•×™ ××•×˜×•××˜×™ (Classifier Hints)
# -------------------------------------------------------------------
# ×× ×§×™×™× infer_equipment ×©×¢×•×‘×“ â€” ××¡×¤×™×§ must_have: pose.available.
# ×× ×œ×, × ×©××•×¨ must_not_have ×œ×¦×™×•×“ ××—×¨ ×›×“×™ ×œ×× ×•×¢ ×˜×¢×•×™×•×ª.
match_hints:
  must_have: [pose.available]
  must_not_have: [objdet.bar_present, objdet.kettlebell_present, objdet.dumbbell_present]
  pose_view: ["front", "front_left", "front_right"]
  motion_pattern: ["hip_down", "knee_flexion"]
  joints_focus: ["hips", "knees", "spine"]
  weight: 1.0

# -------------------------------------------------------------------
# ğŸ” ×¡×¤×™×¨×ª ×—×–×¨×•×ª (Rep Signal)
# -------------------------------------------------------------------
# ×¡×¤×™×¨×” ×œ×¤×™ ×ª× ×•×¢×ª ×”××’×Ÿ (×™×¦×™×‘ ×‘×¡×§×•×•××˜ ××©×§×œ ×’×•×£). ×”×˜×•×•×—×™× ×›××Ÿ ××•×•×¡×ª×™× ×¨×§ ××ª ×”×¡×¤×™×¨×”,
# ×œ× ××ª ×”× ×™×§×•×“ (×”× ×™×§×•×“ × ×§×‘×¢ ×¢"×™ ×§×¨×™×˜×¨×™×•×Ÿ tempo ×œ×¢×™×œ).
rep_signal:
  source: "value|min|hip_y_px"
  thresholds:
    min_rom_good: 60
    min_rep_ms:   600        # ×¡×¤×™×¨×” ×œ× ×ª×§×œ×•×˜ ×¤×—×•×ª ××–×” (××•××œ×¥ ××ª×—×ª ×œ×¡×£ ×”× ×™×§×•×“)
    max_rep_ms:   8000       # ×›×¨×™×ª ×œ×©×”×™×•×ª ××¨×•×›×•×ª ××‘×œ×™ ×œ×©×‘×•×¨ ×¡×¤×™×¨×”

# -------------------------------------------------------------------
# ğŸ—£ï¸ ×¤×™×“×‘×§/×¤×¨×™×™×–×¡
# -------------------------------------------------------------------
# ××™×Ÿ ×¦×•×¨×š ×œ×©× ×•×ª phrases.yaml â€” ×”×§×¨×™×˜×¨×™×•× ×™× ×›××Ÿ ×ª×•×××™× ×œ××¤×ª×—×•×ª ×§×™×™××™×:
# depth_knee, tempo, stance_width, heels_grounded, spine_rounding,
# spine_sidebend, knee_valgus, head_alignment ×•×›×•'. ×”××¢×¨×›×ª ×ª××¤×” ××•×˜×•××˜×™×ª.

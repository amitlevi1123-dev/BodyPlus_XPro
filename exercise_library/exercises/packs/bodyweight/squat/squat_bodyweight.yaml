# -------------------------------------------------------------------
# squat.bodyweight.yaml — סקוואט משקל גוף (Bodyweight Squat)
# -------------------------------------------------------------------
# תרגיל זה נועד לביצוע ללא ציוד. יורש את כל חוקי הניקוד והבטיחות
# מ־squat.base ומבצע התאמות קלות לעומק, קצב ורוחב עמידה.
# -------------------------------------------------------------------

id: squat.bodyweight
family: squat
extends: squat.base

meta:
  selectable: true
  display_name: "סקוואט משקל גוף"
  description: "סקוואט קלאסי ללא ציוד — בודק שליטה, עומק ובטיחות בתנועה טבעית."
  equipment: "none"   # חייב להיות באנגלית כדי שהמסווג יבין שזה ללא ציוד

# -------------------------------------------------------------------
# ⚖️ התאמות ניקוד (Scoring Overrides)
# -------------------------------------------------------------------
scoring:
  criteria:

    # עומק — במשקל גוף אפשר לשאוף לעומק מעט גדול יותר
    depth:
      weight: 1.3
      rule:
        kind: threshold_window
        input: "min(knee_left_deg, knee_right_deg)"
        target_max: 85          # ≤85° = ציון מלא
        cutoff_max: 150         # ≥150° = 0
        direction: lower_is_better

    # קצב — לרוב מהיר וזורם יותר ממשקל חיצוני
    tempo:
      weight: 0.5
      rule:
        kind: tempo_window
        input: rep.timing_s
        min: 0.6
        max: 2.0
        cutoff_min: 0.3
        cutoff_max: 3.0

    # רוחב עמידה — סובלנות רחבה יותר
    stance_width:
      weight: 0.8
      rule:
        kind: band_center
        input: features.stance_width_ratio
        min_ok: 0.85
        max_ok: 1.25
        cutoff_min: 0.65
        cutoff_max: 1.55

    # עקבים נעוצים — חשוב ליציבות
    heels_grounded:
      weight: 0.8
      rule:
        kind: boolean_flag
        input: "(heel_lift_left or heel_lift_right)"  # True = יש הרמה
        good_when: false                              # False = עקבים נעוצים (טוב)
        penalty: 0.50                                 # ענישה בינונית בהרמה

  # תקרות בטיחות — נשמרות כמו במשפחת הסקוואט
  safety_caps:
    - { when: "spine_rounding <= 0.6", cap: 0.70 }
    - { when: "knee_valgus   <= 0.6", cap: 0.75 }
    - { when: "spine_sidebend<= 0.6", cap: 0.80 }

# -------------------------------------------------------------------
# 🧭 רמזים לזיהוי אוטומטי (Auto-Detection)
# -------------------------------------------------------------------
# אם קיים מנגנון infer_equipment שעובד – מספיק pose.available בלבד.
# אם לא, הוספנו must_not_have כדי למנוע בלבול עם תרגילי ציוד.
match_hints:
  must_have: [pose.available]
  must_not_have: [objdet.bar_present, objdet.dumbbell_present, objdet.kettlebell_present]
  pose_view: ["front", "front_left", "front_right"]
  weight: 1.0

# -------------------------------------------------------------------
# 🔁 ספירת חזרות (Rep Signal)
# -------------------------------------------------------------------
# מבוסס על תנועת האגן (hip_y_px) — יציב ובטוח גם בזוויות מצלמה שונות.
rep_signal:
  source: "value|min|hip_y_px"
  thresholds:
    min_rom_good: 60
    min_rep_ms: 400
    max_rep_ms: 6000

# -------------------------------------------------------------------
# 🗣️ חיבור לפידבק (phrases.yaml)
# -------------------------------------------------------------------
# לא דורש שינוי בקובץ phrases.yaml — הקריטריונים כאן תואמים למפתחות:
# depth_knee, tempo, stance_width, heels_grounded, spine_rounding,
# spine_sidebend, knee_valgus, head_alignment, toe_angle וכו’.
# מערכת הפידבק תזהה אוטומטית לפי השמות הקנוניים.
# -------------------------------------------------------------------
# ✅ מוכן לשימוש מלא — אין צורך לערוך את phrases.yaml או aliases.yaml.
# -------------------------------------------------------------------

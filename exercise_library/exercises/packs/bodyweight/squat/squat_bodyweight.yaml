# -------------------------------------------------------------------
# squat_bodyweight.yaml — סקוואט משקל גוף (Bodyweight Squat)
# -------------------------------------------------------------------
# תרגיל זה מיועד לביצוע ללא ציוד. המסווג יבחר בו כאשר הציוד המשוער הוא "none".
# (ההסקה מתבצעת ע"י _infer_equipment: אם אין objdet/bar.* → equipment="none")
# -------------------------------------------------------------------

id: squat.bodyweight
family: squat
extends: squat.base

meta:
  selectable: true
  display_name: "סקוואט משקל גוף"
  description: "סקוואט קלאסי ללא ציוד — בודק שליטה, עומק ובטיחות בתנועה טבעית."
  equipment: "none"   # חשוב: באנגלית. זה מה שהמסווג משתמש בו לסינון וריאנטים.

# ───── התאמות ייחודיות לתרגיל (יורש את כל השאר מה־base) ─────
scoring:
  criteria:

    # עומק — במשקל גוף שואפים מעט עמוק יותר עד ~85° ברך לציון מלא
    depth:
      weight: 1.3
      rule:
        kind: threshold_window
        input: "min(knee_left_deg, knee_right_deg)"
        target_max: 85          # ≤85° = 1.0 (ציון מלא)
        cutoff_max: 150         # ≥150° = 0.0
        direction: lower_is_better

    # קצב — חזרות נוטות להיות מעט זריזות יותר
    tempo:
      weight: 0.5
      rule:
        kind: tempo_window
        input: rep.timing_s
        min: 0.6
        max: 2.0
        cutoff_min: 0.3
        cutoff_max: 3.0

    # רוחב עמידה — סובלנות רחבה יותר למבני גוף שונים
    stance_width:
      weight: 0.8
      rule:
        kind: band_center
        input: features.stance_width_ratio
        min_ok: 0.85
        max_ok: 1.25
        cutoff_min: 0.65
        cutoff_max: 1.55

    # עקבים נעוצים — חשוב במיוחד ללא ציוד
    heels_grounded:
      weight: 0.8
      rule:
        kind: boolean_flag
        input: "(heel_lift_left or heel_lift_right)"  # True אם יש הרמת עקב
        good_when: false        # טוב כשהביטוי False (אין הרמה)
        penalty: 0.50           # כשTrue → הורדה משמעותית של הקריטריון

  # תקרות בטיחות — יורש/משמר מה־base (מצוין כאן לנוחות קריאה)
  safety_caps:
    - { when: "spine_rounding <= 0.6", cap: 0.70 }
    - { when: "knee_valgus   <= 0.6", cap: 0.75 }
    - { when: "spine_sidebend<= 0.6", cap: 0.80 }

# ───── רמזים לזיהוי תרגיל (Auto-Detection) ─────
# הערה: המסווג כבר מסנן לפי meta.equipment="none".
# אין צורך ב-must_not_have כאן, כי _infer_equipment יקבע "none" בהיעדר objdet/bar.*
match_hints:
  must_have: [pose.available]
  pose_view: ["front", "front_left", "front_right"]
  weight: 1.0

# ───── הגדרות ספירת חזרות ─────
# שימוש בעוגני פרק-כף-יד (קיימים כקנוניים ב-aliases):
rep_signal:
  source: "value|min|wrist_left_y_px,wrist_right_y_px"
  thresholds:
    min_rom_good: 60
    min_rep_ms: 400
    max_rep_ms: 6000

# -------------------------------------------------------------------
# הסבר למפתחים:
# - הוריאנט יורש מ־squat.base את כל מדדי הבטיחות (עגילת גב/ולגוס/עיקום צדדי)
#   ואת לוגיקת הניקוד הכללית, ומבצע כאן התאמות לעומק/קצב/רוחב/עקבים.
# - זיהוי "ללא ציוד" בפועל: _infer_equipment בודק אם קיימים מפתחות objdet.* או bar.*
#   אם לא נמצאו → equipment_inferred="none", ואז המסווג מסנן לוריאנטים עם meta.equipment="none".
# - בגלל שהמסווג הנוכחי מנקד לפי must_have/ranges/pose_view/weight בלבד,
#   אין שימוש ב-must_not_have/any_of/שדות דוקומנטריים אחרים בקובץ זה.
# -------------------------------------------------------------------

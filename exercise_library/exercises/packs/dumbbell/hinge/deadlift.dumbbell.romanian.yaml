# =============================================================================
# deadlift.dumbbell.romanian.yaml — Romanian Deadlift (RDL) עם דאמבלים
# נתיב מומלץ:
#   exercise_library/exercises/packs/dumbbell/deadlift.dumbbell.romanian.yaml
# משפחה: hinge | וריאנט: דאמבלים | דגש: טווח זוויתי (ירך/גו), שמירת מתח למעלה
# =============================================================================

id: "deadlift.dumbbell.romanian"
family: "hinge"
extends: "hinge.base"

meta:
  selectable: true
  display_name: "Romanian Deadlift — Dumbbells (RDL)"
  equipment: "dumbbell"
  start_mode: "from_standing"
  version: "1.0.1"
  notes: >
    RDL עם דאמבלים מן העמידה: דחיפת אגן לאחור, דגש אקצנטרי ושמירת מתח.
    חזרה מלאה נספרת בהשלמת ≥95% מהעלייה — אין חובה לנעילה מלאה למעלה.
    שהייה ארוכה מדי למעלה מורידה ניקוד (RDL שומר מתח).
    עומק/ROM מחושבים מזוויות ירך/גו ולא מפיקסלים — עמיד למרחק מצלמה.
    כפות רגליים ישרות (≈0°) תקינות — אין חובה לסיבוב החוצה.

# -----------------------------------------------------------------------------
# 🧭 רמזי זיהוי למסווג (Classifier Hints)
#  - מסנן ציוד חד: חייב דאמבלים; אין מוט/טרפ-בר.
# -----------------------------------------------------------------------------
match_hints:
  must_have: [pose.available, objdet.object_present]
  must_not_have: [objdet.bar_present, objdet.trapbar_present]
  any_of: [objdet.dumbbell_present]
  ranges:
    objdet.object_kind: ["dumbbell"]
  pose_view: ["side", "front_left", "front_right"]
  motion_pattern: ["hip_hinge"]
  joints_focus: ["hips", "spine", "knees"]
  weight: 1.0

# -----------------------------------------------------------------------------
# 🎯 יעדים לווריאנט
# -----------------------------------------------------------------------------
targets:
  # ROM זוויתי (חישוב דלתא זוויות ירך/גו)
  rom_joint:
    hip_rom_deg: 48
    torso_rom_deg: 30

  # שליטה בזמן החלק העליון (לשמור מתח; אין “נעילה” ארוכה)
  top_time_control:
    hold_good_max_s: 0.50
    hold_ok_max_s:   1.00
    hold_hard_cap_s: 2.50

# -----------------------------------------------------------------------------
# ⏱️ חלונות טמפו (הדרכתיים; הניקוד בפועל נקבע ב־scoring)
# -----------------------------------------------------------------------------
tempo_targets:
  rep_t_s:   [1.0, 4.0]
  ecc_s:     [0.8, 3.0]
  con_s:     [0.6, 2.5]
  pause_bot: [0.0, 0.8]
  pause_top: [0.0, 1.0]

# -----------------------------------------------------------------------------
# 🦶 מנח רגליים (הכוונה)
#  - עדכון חשוב: 0–20° תקין (0° = כפות רגליים ישרות זה בסדר!)
# -----------------------------------------------------------------------------
stance_targets:
  stance_width_ratio: [0.85, 1.15]
  toe_angle_deg:      [0, 20]      # ← יישור קדימה מותר לחלוטין
  knee_toe_alignment_ok_abs_deg: 5

# -----------------------------------------------------------------------------
# 🔁 העדפות ספירת חזרות/פאזות
# -----------------------------------------------------------------------------
rep_detection_hints:
  prefer_angles: true            # פאזות/ROM מזוויות ירך/גו
  use_object_y_as_aux: true      # עזר למסלול/יציבות (גובה הדאמבלים = ידיים)
  min_full_up_fraction: 0.95     # ≥95% מהעלייה = חזרה מלאה
  # ניתן לכייל בערוץ הסיגנל אם צריך (לא חובה):
  # thresholds:
  #   min_rom_good: 0.22
  #   min_rep_ms: 400
  #   max_rep_ms: 6000

# -----------------------------------------------------------------------------
# ⚖️ דריסות ניקוד (scoring)
# הערה: שמות הקריטריונים חייבים להתאים לשמות שקיימים ב־hinge.base.
# אם בבסיס הקריטריון נקרא אחרת (למשל head_alignment במקום head_spine),
# עדכן כאן לשם התואם.
# -----------------------------------------------------------------------------
scoring:

  policy:
    missing: skip
    min_criteria_for_full_quality: 3

  criteria:

    # -------------------------
    # בטיחות (גב/ראש)
    # -------------------------
    spine_rounding:                # עגילת גב (סגיטלי)
      weight: 2.0

    lateral_bend:                  # עיקום צדדי
      weight: 1.2

    head_spine:                    # ראש בקו הגו (אם בבסיס זה head_alignment — שנה לשם התואם)
      weight: 1.0

    # -------------------------
    # תבנית הינג'/מניעת "סקוואט"
    # -------------------------
    hinge_posture:                 # יחס גו/ברך — הינג' אמיתי (לא סקוואט)
      weight: 1.6

    knee_flex_limit:               # ברך "פתוחה" יחסית — למנוע דפוס סקוואט
      weight: 1.0

    # -------------------------
    # ROM מזוויות (קריטי)
    # -------------------------
    rom_joint:
      weight: 1.8
      rule:
        kind: rom_joint_min_target
        input: { hip_rom_deg: "auto", torso_rom_deg: "auto" }
        target_hip_deg:   48
        target_torso_deg: 30
        small_rep_min:    0.30
        partial_min:      0.50
        full_up_fraction: 0.95
        clamp_full_range: [0.95, 1.00]

    # -------------------------
    # קצב/שליטה
    # -------------------------
    tempo:
      weight: 1.0

    phase_control:                 # איכות היפוך/פאזות
      weight: 1.2

    turn_quality:
      weight: 0.6

    # -------------------------
    # רגליים/מנח
    # -------------------------
    knee_valgus:
      weight: 1.2

    heels_grounded:
      weight: 0.8

    stance_width:
      weight: 0.6

    # עדכון: לא להעניש על 0° — טווח יעד 0–20° מגדיר "טוב".
    toe_angle:
      weight: 0.5
      rule:
        kind: threshold_window_abs_pair
        input_left:  toe_angle_left_deg
        input_right: toe_angle_right_deg
        target_min:  0
        target_max:  20
        soft_margin: 3   # עדינות סביב הקצה

    # -------------------------
    # עליון (שהייה למעלה) — שמירת מתח
    # -------------------------
    top_time_control:
      weight: 0.6
      rule:
        kind: top_hold_penalty
        input: rep.pause_top_s
        good_max_s:   0.50
        ok_max_s:     1.00
        hard_cap_s:   2.50

  # תקרות בטיחות (Caps)
  safety_caps:
    - when: "spine_rounding <= 0.60"
      cap: 0.80
    - when: "knee_valgus   <= 0.60"
      cap: 0.90
    - when: "head_spine    <= 0.60"
      cap: 0.92

  aggregate:
    method: weighted_mean
    weights_source: inline

# -----------------------------------------------------------------------------
# 📣 חיווט משפטים (phrases)
# -----------------------------------------------------------------------------
phrases:
  namespace: "hinge.rdl"
  inherit_common_maps: true
  maps:
    rom_joint:
      rep_short: "hinge.common.rom_joint.rep_short"
      rep_too_short: "hinge.common.rom_joint.rep_too_short"
      rep_good: "hinge.common.rom_joint.rep_good"
    turn_quality:
      rep_weak: "hinge.common.turn.rep_weak"
      rep_good: "hinge.common.turn.rep_good"
    top_time_control:
      long_hold:  "hinge.rdl.top_tension.rep_long_hold"
      too_locked: "hinge.rdl.top_tension.rep_too_locked"

# -----------------------------------------------------------------------------
# 🧪 בדיקות מומלצות (QA)
# -----------------------------------------------------------------------------
qa_notes:
  - "סט א׳ ללא עצירה למעלה מול סט ב׳ עם 2–3s עצירה: ב׳ צריך לרדת דרך top_time_control."
  - "בדוק שחזרות עם 95–100% עלייה נחשבות מלאות (ללא קפיצה 99→100)."
  - "ודא ש-ROM מזוויות עובד זהה ממרחקי מצלמה שונים."
  - "ודא שהקריטריונים של הינג' (hinge_posture/knee_flex_limit) מונעים 'סקוואט'."
  - "עגילת גב מחמירה: spine_rounding<0.60 מפעיל cap=0.80 על ציון הסופי."

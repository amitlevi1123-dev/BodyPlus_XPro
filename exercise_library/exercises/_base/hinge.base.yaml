# =============================================================================
# ğŸ§  hinge.base.yaml â€” ××©×¤×—×ª ×ª× ×•×¢×•×ª Hinge / Deadlift
# -----------------------------------------------------------------------------
# ××˜×¨×ª ×”××©×¤×—×”: ×œ××“×•×“ ×ª× ×•×¢×” ××‘×•×¡×¡×ª Hinge â€” ×“×“×œ×™×¤×˜×™×, RDL, ×¡×˜×™×£-×œ×’, ×˜×¨×¤-×‘×¨ ×•×›×•â€™.
#
# ×¢×§×¨×•× ×•×ª:
# - ROM ×–×•×•×™×ª×™ ×œ×¤×™ ×™×¨×š+×’×• (×—×¡×™×Ÿ ××¨×—×§/×–×•×; ×œ× ××¡×ª××š ×¢×œ ×¤×™×§×¡×œ×™×)
# - ×–×™×”×•×™ ×¤××–×•×ª ×¢"×™ torso_forward_deg + hip_*_deg; object_y ×¨×§ ×›×’×™×‘×•×™
# - × ×™×§×•×“ ×‘×˜×™×—×•×ª/×ª×‘× ×™×ª/×©×œ×™×˜×”/×¢××™×“×”; Top (× ×¢×™×œ×”/××ª×—) ×™×•×’×“×¨ ×‘×•×•×¨×™×× ×˜×™×
# - ×›×œ ×”××¤×ª×—×•×ª ×§× ×•× ×™×™× ×œ×¤×™ aliases.yaml
# =============================================================================

meta:
  id: "hinge.base"
  family: "hinge"
  display_name: "×ª× ×•×¢×ª Hinge (×‘×¡×™×¡ ××©×¤×—×”)"
  selectable: false
  version: 1.0.0
  notes: >
    ×”×•×•×¨×™×× ×˜×™× (×“×“×œ×™×¤×˜ ×¨×’×™×œ, RDL, ×¡×˜×™×£-×œ×’, ×˜×¨×¤-×‘×¨, KB/DB, ××©×§×œ-×’×•×£) ×™×•×¨×©×™× ××”×‘×¡×™×¡
    ×•××©× ×™× ×‘×¢×™×§×¨ ××ª start_mode/targets ×•××“×™× ×™×•×ª ×”-Top (× ×¢×™×œ×”/××ª×—).

# =============================================================================
# ğŸ§­ ×¨××–×™× ×œ××¡×•×•×’ â€” ×‘×¡×™×¡ (×•×•×¨×™×× ×˜×™× ×™×¨×—×™×‘×• ×œ×¤×™ ×¦×™×•×“)
# =============================================================================
match_hints:
  must_have: [pose.available]
  pose_view: ["side", "front_left", "front_right"]
  motion_pattern: ["hip_hinge"]
  joints_focus: ["hips", "spine", "knees"]

# =============================================================================
# ğŸ§¾ ×”×’×“×¨×•×ª ×›×œ×œ×™×•×ª / ×™×¢×“×™ ROM ×‘×¨×™×¨×ª-××—×“×œ (×•×•×¨×™×× ×˜×™× ×¨×©××™× ×œ×“×¨×•×¡)
# =============================================================================
defaults:
  lockout_mode: "inherit"   # ×™×•×’×“×¨ ×‘×•×•×¨×™×× ×˜: "full_lockout" / "tension_top"
  targets:
    from_floor:    { hip_deg: 60, torso_deg: 35 }
    from_standing: { hip_deg: 48, torso_deg: 30 }

# =============================================================================
# ğŸ§© ×§×¨×™×˜×¨×™×•× ×™× (××” ××•×“×“×™×)
# =============================================================================
criteria:

  # ----- ×§×¨×™×˜×™×™× (×‘×œ×¢×“×™×”× ××™×Ÿ × ×™×§×•×“ ×—×–×¨×”) -----
  critical:
    - pose.available
    - spine_flexion_deg
    - torso_forward_deg
    - hip_left_deg
    - hip_right_deg

  # ----- ××§×•×¨×•×ª ×¢×–×¨ ×œ×¤××–×•×ª/×¡×¤×™×¨×” (×œ× ×—×•×‘×”; ×œ×¤×—×•×ª ××—×“) -----
  fallback_sources:
    - object_y
    - hands_center_y
    - hip_y_px

  # ----- ×ª×‘× ×™×ª Hinge -----
  hinge_posture:
    requires: [torso_forward_deg, knee_left_deg, knee_right_deg]
    # ×”×’×™×•×Ÿ: ×”×™× ×’' ×ª×§×™×Ÿ = ×”×˜×™×™×ª ×’×• ××©××¢×•×ª×™×ª ××•×œ ×›×¤×™×¤×ª ×‘×¨×š ××ª×•× ×” (×œ× ×œ×”×¤×•×š ×œ×¡×§×•×•××˜)

  knee_flex_limit:
    requires: [knee_left_deg, knee_right_deg]
    # ×™×¢×“ ×˜×™×¤×•×¡×™ ~100â€“115Â° (×“×¨×™×¡×” ×‘×•×•×¨×™×× ×˜/×‘×§×•×“ ×”× ×™×§×•×“)

  # ----- ROM ×–×•×•×™×ª×™ (×©××¨× ×™) -----
  rom_joint:
    requires: [hip_left_deg, hip_right_deg, torso_forward_deg]
    # ×—×™×©×•×‘ ×‘×§×•×“: min( hip_rom/target_hip , torso_rom/target_torso )

  # ----- ×‘×˜×™×—×•×ª -----
  spine_rounding:   { requires: [spine_flexion_deg] }
  lateral_bend:     { requires: [spine_curvature_side_deg] }
  head_alignment:   { requires: [head_pitch_deg, torso_forward_deg] }

  # ----- ×¢××™×“×”/×¨×’×œ×™×™× -----
  stance_width:     { requires: [features.stance_width_ratio] }
  toe_angle:        { requires: [toe_angle_left_deg, toe_angle_right_deg] }
  knee_valgus:      { requires: [knee_foot_alignment_left_deg, knee_foot_alignment_right_deg] }
  heels_grounded:   { requires: [heel_lift_left, heel_lift_right] }
  foot_contact:     { requires: [foot_contact_left, foot_contact_right] }
  weight_shift:     { requires: [weight_shift] }

  # ----- ×§×¦×‘/×¤××–×•×ª -----
  tempo:            { requires: [rep.timing_s] }
  phase_control:    { requires: [rep.ecc_s, rep.con_s, rep.pause_bottom_s, rep.pause_top_s] }
  phase_balance:    { requires: [rep.ecc_s, rep.con_s] }
  turn_quality:     { requires: [rep.dir, rep.state, rep.phase] }

  # ----- Hook ×œ×¦××¨×ª (Top) â€” ×”×•×•×¨×™×× ×˜ ×§×•×‘×¢ ××™×š ×œ×¤×¨×© -----
  top_quality_hook: { requires: [rep.pause_top_s, torso_forward_deg, spine_flexion_deg, heel_lift_left, heel_lift_right] }

# =============================================================================
# âš–ï¸ SCORING â€” ××“×™× ×™×•×ª ×•×›×œ×œ×™ × ×™×§×•×“ (×‘×¨××ª ×”×‘×™×™×¡)
# =============================================================================
scoring:

  policy:
    missing: skip
    min_criteria_for_full_quality: 3

  # ××©×§×œ×™× ××•×¦×¢×™× (0â€“2) â€” ×”× ×•×¡×—×” ×‘×§×•×“ ××‘×¦×¢×ª weighted_mean
  weights:
    spine_rounding: 2.0
    lateral_bend:   1.4
    head_alignment: 1.2

    hinge_posture:  1.8
    knee_flex_limit:1.0

    rom_joint:      1.5

    phase_control:  1.5
    tempo:          1.0
    phase_balance:  0.8

    knee_valgus:    1.4
    heels_grounded: 1.0
    stance_width:   0.8
    toe_angle:      0.6
    foot_contact:   0.6
    weight_shift:   0.6

    turn_quality:   0.5
    top_quality_hook: 1.0

  # ×ª×§×¨×•×ª ×‘×˜×™×—×•×ª ×›×œ×œ×™×•×ª (×’×‘×•×œ ×¢×œ ×œ×¦×™×•×Ÿ ×”×¡×•×¤×™)
  safety_caps:
    - { when: "spine_rounding <= 0.6", cap: 0.85 }
    - { when: "knee_valgus   <= 0.6", cap: 0.90 }
    - { when: "heels_grounded<= 0.5", cap: 0.90 }

# =============================================================================
# ğŸ” ×¡×¤×™×¨×ª ×—×–×¨×•×ª â€” ×”×’×“×¨×•×ª ×¡×™×’× ×œ ×•×’×™×™×˜
# =============================================================================
rep_signal:
  # ×‘×•×—×¨×™× ×¡×™×’× ×œ ×–×•×•×™×ª×™, ×—×¡×™×Ÿ ××¨×—×§/×–×•×:
  source: "angle|min|torso_forward_deg,hip_left_deg,hip_right_deg"
  thresholds:
    phase_delta: 5         # ×©×™× ×•×™ ××™× ×™××œ×™ ×›×“×™ ×œ×¦××ª ×-start
    min_turn_ms: 100       # ×”×©×”×™×™×” ××™× ×™××œ×™×ª ×‘-turn ×œ×× ×™×¢×ª false-turn
    min_rep_ms: 500
    max_rep_ms: 6000
    # ×¡×¤×™ ROM ××™× ×™××œ×™×™× ×œ×¡×™×•×•×’ ××™×›×•×ª (×‘××¢×œ×•×ª):
    min_rom_good: 25
    min_rom_partial: 18

rep_detection:
  phases: [start, towards, turn, away]
  turn_guard:
    min_rom_fraction: 0.30      # ××ª×—×ª ×œ×–×” â€” ×œ× ×—×–×¨×”
    small_rep_threshold: 0.50   # ×‘×™×Ÿ 0.30â€“0.50 â†’ partial/short (×œ×¤×™ gate)
  description: >
    ×–×™×”×•×™ ×—×–×¨×” ×‘×¢×™×§×¨ ××–×•×•×™×•×ª; object_y/hands_center_y/hip_y_px ××©××©×™× ×›×’×™×‘×•×™ ×‘×œ×‘×“.
    ××“×™× ×™×•×ª Top (× ×¢×™×œ×”/××ª×—) ×œ× × ××›×¤×ª ×›××Ÿ â€” ×ª×•×’×“×¨ ×‘×•×•×¨×™×× ×˜ ×•×ª×©×¤×™×¢ ×›××›×¤×™×œ.

# =============================================================================
# ğŸ“£ ×—×™×‘×•×¨ ×œ×¤×™×“×‘×§ â€” ××™×¤×•×™ ×§×¨×™×˜×¨×™×•× ×™× â†” ×§×‘×•×¦×•×ª ××©×¤×˜×™× ×§×™×™××•×ª (phrases.yaml)
# =============================================================================
feedback:
  # ×œ×›×œ ×§×¨×™×˜×¨×™×•×Ÿ ××¦×•×™× ×ª ×§×‘×•×¦×ª ×”××©×¤×˜×™× ×”"×’× ×¨×™×ª" ×”×§×™×™××ª ×‘×§×•×‘×¥ he:
  bindings:
    rom_joint:        range_of_motion           # rep_good / set_good / rep_weak / ...
    tempo:            tempo
    phase_control:    tempo_control
    hinge_posture:    posture                   # ×©×™××•×©×™ ×œ×¤×™×“×‘×§ ×¢×œ ×”×˜×™×™×ª ×’×• ×›×œ×œ×™×ª
    spine_rounding:   spine_rounding
    lateral_bend:     spine_sidebend
    head_alignment:   head_alignment

    stance_width:     stance_width
    toe_angle:        toe_angle_target          # 8â€“20Â°
    knee_valgus:      knee_alignment
    heels_grounded:   heels_grounded
    foot_contact:     foot_contact
    weight_shift:     weight_shift

  # ××™×¨×•×¢×™ ×¡×˜ ×›×œ×œ×™×™× (×œ×œ× Top) â€” ×§×™×™××™× ×›×‘×¨ ××¦×œ×š ×‘×§×•×‘×¥ (measurement_quality/general)
  set_events:
    pose_missing:     measurement_quality.pose_missing
    visibility_low:   measurement_quality.visibility_low
    not_enough_frames: general.not_enough_frames
    low_confidence:   general.low_pose_confidence

  # Top-policy specific â€” ×™×•×’×“×¨×• ×‘×•×•×¨×™×× ×˜×™× (×©××•×ª ×§×•×“×™× ×‘×œ×‘×“; ×”×˜×§×¡×˜×™× ×‘-phrases):
  variant_placeholders:
    conventional_last_rep_no_full_lockout: "set.last_rep_no_full_lockout"
    rdl_excessive_top_hold:                "set.excessive_top_hold_for_rdl"

# =============================================================================
# ğŸ“ˆ ×¡×™×›×•× ×¢×§×¨×•× ×•×ª
# =============================================================================
summary:
  - ×§×¨×™×˜×¨×™×•× ×™× ×§×¨×™×˜×™×™× ××–×•×•×™×•×ª ×‘×œ×‘×“ â†’ ×—×¡×™× ×•×ª ×œ×©×™× ×•×™×™× ×‘×¦×™×œ×•×.
  - × ×™×§×•×“ ××©×•×§×œ×œ + ×ª×§×¨×•×ª ×‘×˜×™×—×•×ª ××•× ×¢×™× â€œ×¦×™×•×Ÿ ×™×¤×”â€ ×¢× ×˜×›× ×™×§×” ××¡×•×›× ×ª.
  - Top (× ×¢×™×œ×”/××ª×—) ×”×•× ×¤×¨ ×•×•Ö¼×¨×™×× ×˜ â€” ××™×Ÿ ×¢× ×™×©×” ×‘×‘×™×™×¡.
  - ROM ×œ×¤×™ hip+torso ×¢× ×™×¢×“×™ ×‘×¨×™×¨×ª-××—×“×œ, × ×™×ª× ×™× ×œ×“×¨×™×¡×”.

# =============================================================================
# ğŸš€ ×©×™×¤×•×¨×™× ×¢×ª×™×“×™×™× (Roadmap)
# =============================================================================
future_improvements:
  - pelvis_tilt_and_rotation: "×œ×–×”×•×ª ×”×™×¤×¨××§×¡×˜× ×©×Ÿ/×¡×˜×™×•×ª ××’×Ÿ ×‘×˜×•×¤."
  - object_x_tracking:        "××¡×œ×•×œ ××•×¤×§×™ (bar path) ×œ×‘×“×™×§×ª â€˜××•×˜ ×§×¨×•×‘ ×œ×’×•×£â€™."
  - symmetry_indices:         "××™×–×•×Ÿ ×™××™×Ÿ/×©×××œ (hips/shoulders) ×œ×–×™×”×•×™ ×”×˜×™×•×ª."
  - adaptive_targets:         "×™×¢×“×™ ROM/Tempo ××•×ª×××™× ×’×•×‘×”/××•×¨×š ×’×¤×™×™×."
  - phase_jerk_metrics:       "××“×“×™ â€˜×§×¤×™×¦×”â€™ ×‘×”×™×¤×•×š/×˜×•×¤ ×œ×¤×™ ××”×™×¨×•×ª/×ª××•×¦×”."
  - grip_width:               "××“×“ ×¨×•×—×‘ ××—×™×–×” â€” ×™×•×¤×¢×œ ×‘×•×•×¨×™×× ×˜×™× ×¢× ××•×˜/×“×××‘×œ×™×."

# =============================================================================
# ğŸ§  ×”×¢×¨×›×ª ×××™× ×•×ª
# =============================================================================
review:
  summary: >
    ×”×‘×™×™×¡ ×™×¦×™×‘ ×•×××™×Ÿ ×œ××¦×œ××” ××—×ª: ROM ×–×•×•×™×ª×™, ×¡×™×’× ×œ ×—×–×¨×•×ª × ×§×™, ×•×—×™×‘×•×¨ ××œ× ×œ-phrases
    ×”×’× ×¨×™×™×. ×”×•×•×¨×™×× ×˜×™× ××•×¡×™×¤×™× ×¨×§ ×¦×™×•×“/start_mode/×™×¢×“×™× ×•××“×™× ×™×•×ª Top, ×‘×œ×™ ×œ×©× ×•×ª
    ××ª ×”×œ×™×‘×” â€” ××” ×©××•× ×¢ ×‘××’×™× ×‘×™×Ÿ ×ª×¨×’×™×œ×™× ×•×©×•××¨ ×¢×œ ×¢×§×‘×™×•×ª ×‘×“×•×—×•×ª.

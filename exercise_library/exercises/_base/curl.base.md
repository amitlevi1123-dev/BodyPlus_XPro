יאללה, עדכנתי את האיפיון לפי ההערות שלך + ניקיתי אי-הגיוניות. בלי קוד כאן (אשלח `curl.barbell.yaml` מיד אחרי שתאשר).

---

# 🏋️‍♂️ כפיפות מרפקים עם מוט (Barbell Curl) — איפיון מעודכן

## 🎯 מטרה

מדידה וניקוד של כפיפות מרפקים בעמידה עם **מוט** תוך דגש על **שליטה**, **אפס סווינג בגו**, **ללא הרמות כתף**, **טמפו איטי ומבוקר**, **ברכיים רכות**, ו־**רוחב אחיזה סביב כתפיים**.

---

## ✅ תנאי חובה למדידה

* `pose.available` — הגוף מזוהה.
* `objdet.bar_present` — זיהוי מוט (חובה; אם אין → לא סופרים תרגיל/חזרות).
* שינוי זווית מרפק רציף ≥ **7°** במשך ≥ **120ms** כדי להתחיל חזרה.
* **ללא סווינג חזק** בגו (מבוסס מהירות/האצה של `torso_forward_*`).
* **ללא הרמות כתף** (גלישת כתף/מרפק קדימה).

> **Pass/Fail לפני ניקוד:** אם אין מוט, או שהסווינג/הרמות-כתף חורגים מהגבולות הקשים — החזרה נפסלת.

---

## 🔄 הגדרת חזרה (Rep Flow)

* **מצב התחלה (Ready):** מרפקים כמעט ישרים **175–180°**, גב זקוף, כתפיים מעל המרפקים, **ברכיים רכות**.
* **תחילת תנועה:** ירידה רציפה ≥7° במרפק לאורך ≥120ms.
* **היפוך (Turn) תקף:** מזוהה רק לאחר ≥100ms רצף של שינוי כיוון (מונע “באמפ”).
* **סיום חזרה (Counting Rule):**
  **נספרת רק בתחתית** — כשהמרפק חוזר להארכה של **≥170°** (או עובר את סף ההארכה התחתון שהוגדר), **לא** נספרת על עצירה/השייה בחלק העליון.
  (עצירה למעלה יכולה לקבל פידבק, אבל לא “סוגרת” חזרה.)
* **עצירה בתחתית (Bottom Pause):** עצירה ארוכה מדי **> 1.3s** תוריד ציון (מפחיתה עומס).
* **טמפו יעד לחזרה:** **2.5–4.0s** (ראה “היגיון והזהרות” למטה).
  מהיר מדי: **< 2.5s**.
  איטי מדי (ללא סיבה): **> 5.0s**.

---

## 🧭 יעדי איכות (ספים)

| תחום                    | יעד תקין                                              | בעייתי                            |
| ----------------------- | ----------------------------------------------------- | --------------------------------- |
| **ROM מרפק**            | כיפוף נטו **≈90°** (מקצה הארכה ≥170° לקצה כיפוף ≤80°) | ROM < 70° קצר                     |
| **טמפו (rep.timing_s)** | **2.5–4.0s**                                          | **<2.5s מהיר**, **>5.0s איטי**    |
| **שליטה בהיפוך**        | Turn חלק ללא “באונס”                                  | היפוך חד/קפיצה                    |
| **גו (סווינג)**         | יציב; מהירויות/האצות מתונות                           | סווינג בולט → ענישה חדה/תקרת ציון |
| **כתפיים**              | יציבות; מרפק מתחת לכתף                                | הרמת כתף/גלישה קדימה              |
| **ברכיים**              | רכות                                                  | נעילה מלאה                        |
| **רוחב אחיזה**          | **0.9–1.2×** מרוחב כתפיים                             | צר/רחב מחוץ לטווח                 |
| **שורש כף היד**         | ניטרלי                                                | כיפוף/סטייה חזקה                  |

---

## 🧮 חלוקת ניקוד (סה״כ 10)

* **גו ללא סווינג** — **2.2**
* **יציבות כתפיים** — **2.0**
* **טמפו (2.5–4.0s)** — **1.8**
* **שליטה בהיפוך (Turn)** — **1.6**
* **ROM מרפק** — **1.0**  *(מדד משני בתרגיל הזה)*
* **ברכיים רכות** — **0.5**  *(בונוס יציבות)*
* **רוחב אחיזה** — **0.5**
* **שורש כף היד ניטרלי** — **0.4**

> ניקוד פנימי: ליניארי/חתיכתי סביב היעדים, עם קליפינג עד 0.

---

## ⚠️ ענישות ותקרות ציון

* **Bottom Pause > 1.3s** → הורדה קלה (זרימה לא רציפה).
* **חזרה מהירה < 2.5s** → הורדה משמעותית.
* **סווינג חזק בגו** → תקרת ציון **0.85** לחזרה.
* **הרמות כתף משמעותיות** → תקרת ציון **0.88**.
* **גב מתעגל** → תקרת ציון **0.90**.
* **רוחב אחיזה מחוץ ל־0.9–1.2×** → הורדה קלה + הודעת כיוון.
* **ברכיים נעולות** → הורדה קלה.

---

## 🧩 מדדים רלוונטיים (aliases)

* **מרפקים:** `elbow_left_deg`, `elbow_right_deg`
* **כתפיים:** `shoulder_left_deg`, `shoulder_right_deg`
* **גו/גב:** `torso_forward_deg`, `torso_forward_vel_deg_s`, `torso_forward_acc_deg_s2`, `spine_flexion_deg`
* **חזרות/טמפו:** `rep.timing_s`, `rep.ecc_s`, `rep.con_s`, `rep.pause_top_s`, `rep.pause_bottom_s`
* **ציוד:** `objdet.bar_present`
* **רוחב אחיזה:** `shoulders_width_px` *(כעת)*; **עתידי:** `grip_width_px` להשוואה מדויקת
* **אינדיקציית מהירות עודפת ספציפית:** שימוש משולב ב־`rep.timing_s` + דגלי Swing

---

## 💬 פידבק לדשבורד (דוגמאות)

* **סווינג:** “נראתה תנודה בגו — שמור גב יציב.”
* **כתף:** “המרפקים צריכים להישאר מתחת לכתפיים — אל תרום בכתף.”
* **מהירות יתר:** “הקצב מהיר מדי — האט ושמור שליטה.”
* **עצירה תחתית:** “עצירה ארוכה מדי בתחתית — שמור זרימה רציפה.”
* **ברכיים:** “שמור ברכיים רכות — יציבות טובה יותר.”
* **רוחב אחיזה:** “האחיזה צרה/רחבה מדי — כוון סביב רוחב כתפיים.”
* **שורש כף היד:** “כף היד נוטה — יישר מעט לשיפור שליטה.”

---

## 🔭 שיפורים עתידיים

1. **Object Path**: מעקב `object_x`, `bar.y_px` לזיהוי סווינג/מסלול לא אנכי.
2. **Shoulder Drift Metric**: מדידה כמותית של תנועת כתף לעומת מרפק.
3. **`grip_width_px`**: חישוב רוחב אחיזה אמיתי מול כתפיים.
4. **Adaptive Tempo**: התאמת טווחי קצב לרמת המשתמש.
5. **Rep Consistency**: שונות בין חזרות באותו סט (ROM, קצב, יציבות).

---

## 🧪 בדיקת היגיון — מה תיקַנּו ומה עוד לשים לב

* ✔️ **Bottom pause** עודכן ל־**1.3s** (לפני כן 0.6s) — תואם רצונך לא להעניש עצירות קצרות אלא רק ארוכות ממש.
* ✔️ **Start Ready 175–180°** במקום נעילת 175° בלבד.
* ✔️ **סיום חזרה רק בתחתית** (הגעה/מעבר ≥170° הארכה); **עצירה למעלה לא סוגרת חזרה** — רק תורמת/מורידה ניקוד לפי איכות.
* ✔️ **טמפו “מהיר מדי” < 2.5s** — תואם לבקשתך.
  **הערת היגיון:** ערך זה מחמיר מאוד (רבות מהחזרות האופייניות ייחשבו מהירות). כדי לא “להרוג” משתמשים טובים, קבענו יעד **2.5–4.0s** ו”איטי מאוד” > **5.0s**. אם תרצה, אפשר להחמיר עוד.
* ✔️ **מוט = חובה** ב־`must_have`.
* 🔎 **שווה לעקוב**: אם ה־ROM בפועל יהיה קטן מהמצופה בגלל משתמשים “מקצרים” עליון/תחתון, נעדכן סף ROM המינימום (כעת 70°) לאחר טסטים מהשטח.

---

אם זה מאושר — שולח עכשיו את קובץ הקונפיג **`curl.barbell.yaml`** תואם (עם `must_have`, טווחי זוויות, טמפו, הענישות המעודכנות, ורוחב אחיזה).

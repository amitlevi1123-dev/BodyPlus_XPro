# =============================================================================
# 📘 aliases.yaml — מיפוי שמות raw → canonical לכל המערכת
# =============================================================================
# שימוש:
# 1) כל מנועי הניתוח/ציון משתמשים רק בשמות הקנוניים כאן.
# 2) אם ה-raw משתנה, הוסיפו alias תחת המפתח הקנוני (אל תשנו את הקנוני).
# 3) ה-Normalizer יזהה קונפליקטים בין aliases של אותו מפתח לפי "tolerances".
#
# הערות:
# • Pass-Through: יש פרפיקסים שה-Normalizer מעביר גם בלי רישום (rep./bar./pose./view./features./objdet.).
#   עדיין מומלץ לרשום כאן לטובת עקיבות.
# • יחידות (unit) משמשות לחישוב טולרנסים בקונפליקטים.
# • אל תכפלו מפתחות קנוניים — הרחיבו רשימות aliases בלבד.
# =============================================================================

settings:
  normalizer:
    conflict_strategy:
      numeric: mean
      text: first
      bool: first
    pass_through_prefixes: [rep., bar., pose., view., features., objdet.]

canonical_keys:

  # ────────────────────────────────────────────────────────────────────────────
  # מטא / איכות חישוב / נראות / נוכחות
  # ────────────────────────────────────────────────────────────────────────────
  dt_ms:
    unit: ms
    aliases: [dt_ms, dt]

  max_dt_ms:
    unit: ms
    aliases: [max_dt_ms, max_dt]    # לשימוש בסיכומי set_visibility_audit

  average_visibility:
    unit: ratio
    aliases: [average_visibility, vis_avg]

  quality_score:
    unit: ratio
    aliases: [quality_score, view_score]

  person_ratio:
    unit: ratio
    aliases: [person_ratio, presence_ratio]

  measurements.ok:
    unit: bool
    aliases: [measurements.ok, measurements_ok, measure_ok]

  # ────────────────────────────────────────────────────────────────────────────
  # מצב מצלמה / פוזה
  # ────────────────────────────────────────────────────────────────────────────
  view.mode:
    unit: text
    aliases: [view.mode, view_mode, view.primary]

  pose.available:
    unit: bool
    aliases: [pose.available, pose.ok, pose]

  pose.confidence:
    unit: ratio
    aliases: [pose.confidence, pose.average_confidence, confidence]

  # ────────────────────────────────────────────────────────────────────────────
  # ציוד / אובייקטים + פרוקסי גובה
  # ────────────────────────────────────────────────────────────────────────────
  bar.y_px:
    unit: px
    aliases: [bar.y_px, bar_y_px, bar.y]

  objdet.bar_present:
    unit: bool
    aliases: [objdet.bar_present, bar.present]

  objdet.dumbbell_present:
    unit: bool
    aliases: [objdet.dumbbell_present, dumbbell.present]

  objdet.kettlebell_present:
    unit: bool
    aliases: [objdet.kettlebell_present, kettlebell.present]

  objdet.trapbar_present:
    unit: bool
    aliases: [objdet.trapbar_present, trapbar.present]

  objdet.object_present:
    unit: bool
    aliases: [objdet.object_present, equipment.present, object.present]

  objdet.object_kind:
    unit: text
    aliases: [objdet.object_kind, equipment.kind, object.kind]
    # ערכים מומלצים: barbell, dumbbell, kettlebell, trapbar, plate, band, bodyweight, unknown

  object_y:
    unit: px
    aliases: [object_y, object.y_px, equipment.y, equipment.y_px]

  hands_center_y:
    unit: px
    aliases: [hands_center_y, hands_center_y_px, hands.centroid_y_px]

  hip_y_px:
    unit: px
    aliases: [hip_y_px, hip.y_px]

  # ────────────────────────────────────────────────────────────────────────────
  # נקודות יד (לעוגני rep/מסלולי מוט/Press)
  # ────────────────────────────────────────────────────────────────────────────
  wrist_left_y_px:
    unit: px
    aliases: [wrist_left_y_px, wrist_y_left, hand_y_left]

  wrist_right_y_px:
    unit: px
    aliases: [wrist_right_y_px, wrist_y_right, hand_y_right]

  # יחסי עומק Press
  press.hand_y_rel_chest:
    unit: ratio
    aliases: [press.hand_y_rel_chest, hand_y_rel_chest]

  press.hand_y_rel_head:
    unit: ratio
    aliases: [press.hand_y_rel_head, hand_y_rel_head]

  # מסלולי מוט (שיפוע/אנכיות)
  bar.path_angle_from_vertical_deg:
    unit: deg
    aliases: [bar.path_angle_from_vertical_deg, bar_path_angle_from_vertical_deg]

  # ────────────────────────────────────────────────────────────────────────────
  # יציבה / גו / עמוד שדרה
  # ────────────────────────────────────────────────────────────────────────────
  torso_forward_deg:
    unit: deg
    aliases: [torso_forward_deg, torso_vs_vertical_deg, torso_lean_deg]

  torso_vs_horizontal_deg:
    unit: deg
    aliases: [torso_vs_horizontal_deg, torso_forward_side_deg]

  spine_flexion_deg:
    unit: deg
    aliases: [spine_flexion_deg]

  spine_curvature_side_deg:
    unit: deg
    aliases: [spine_curvature_side_deg]

  head_delta_deg:
    unit: deg
    aliases: [head_delta_deg, head_vs_torso_deg, head_torso_delta_deg]

  torso_forward_vel_deg_s:
    unit: deg_s
    aliases: [torso_forward_vel_deg_s]

  torso_forward_acc_deg_s2:
    unit: deg_s2
    aliases: [torso_forward_acc_deg_s2]

  spine_curvature_side_vel_deg_s:
    unit: deg_s
    aliases: [spine_curvature_side_vel_deg_s]

  spine_curvature_side_acc_deg_s2:
    unit: deg_s2
    aliases: [spine_curvature_side_acc_deg_s2]

  spine_curvature_side_jitter_std:
    unit: deg
    aliases: [spine_curvature_side_jitter_std]

  # ────────────────────────────────────────────────────────────────────────────
  # אגן (Pelvis)
  # ────────────────────────────────────────────────────────────────────────────
  pelvis_tilt_deg:
    unit: deg
    aliases: [pelvis_tilt_deg]

  pelvis_rotation_deg:
    unit: deg
    aliases: [pelvis_rotation_deg]

  # ────────────────────────────────────────────────────────────────────────────
  # מפרקים עיקריים
  # ────────────────────────────────────────────────────────────────────────────
  shoulder_left_deg:
    unit: deg
    aliases: [shoulder_left_deg, shoulder_angle_left]

  shoulder_right_deg:
    unit: deg
    aliases: [shoulder_right_deg, shoulder_angle_right]

  elbow_left_deg:
    unit: deg
    aliases: [elbow_left_deg, elbow_angle_left, measurements.elbow_left_deg]

  elbow_right_deg:
    unit: deg
    aliases: [elbow_right_deg, elbow_angle_right]

  hip_left_deg:
    unit: deg
    aliases: [hip_left_deg]

  hip_right_deg:
    unit: deg
    aliases: [hip_right_deg]

  knee_left_deg:
    unit: deg
    aliases: [knee_left_deg, measurements.knee_left_deg, knee_angle_left]

  knee_right_deg:
    unit: deg
    aliases: [knee_right_deg, measurements.knee_right_deg, knee_angle_right]

  hip_delta_deg:
    unit: deg
    aliases: [hip_delta_deg]

  knee_delta_deg:
    unit: deg
    aliases: [knee_delta_deg]

  # ────────────────────────────────────────────────────────────────────────────
  # קרסול / שורש-כף-יד
  # ────────────────────────────────────────────────────────────────────────────
  ankle_dorsi_left_deg:
    unit: deg
    aliases: [ankle_dorsi_left_deg]

  ankle_dorsi_right_deg:
    unit: deg
    aliases: [ankle_dorsi_right_deg]

  wrist_flex_ext_left_deg:
    unit: deg
    aliases: [wrist_flex_ext_left_deg]

  wrist_flex_ext_right_deg:
    unit: deg
    aliases: [wrist_flex_ext_right_deg]

  wrist_radial_ulnar_left_deg:
    unit: deg
    aliases: [wrist_radial_ulnar_left_deg]

  wrist_radial_ulnar_right_deg:
    unit: deg
    aliases: [wrist_radial_ulnar_right_deg]

  # ────────────────────────────────────────────────────────────────────────────
  # עמידה / כפות רגליים / יישור ברך
  # ────────────────────────────────────────────────────────────────────────────
  features.stance_width_ratio:
    unit: ratio
    aliases: [features.stance_width_ratio, feet_w_over_shoulders_w, stance_width_ratio, stance_ratio]

  toe_angle_left_deg:
    unit: deg
    aliases: [toe_angle_left_deg, fpa_left_deg]

  toe_angle_right_deg:
    unit: deg
    aliases: [toe_angle_right_deg, fpa_right_deg]

  knee_foot_alignment_left_deg:
    unit: deg
    aliases: [knee_foot_alignment_left_deg, knee_toe_alignment_left_deg, knee_valgus_left_deg, kfa_left_deg, knee_toe_left_deg]

  knee_foot_alignment_right_deg:
    unit: deg
    aliases: [knee_foot_alignment_right_deg, knee_toe_alignment_right_deg, knee_valgus_right_deg, kfa_right_deg, knee_toe_right_deg]

  # סעיפים בוליאניים למגע/עקבים
  heel_lift_left:
    unit: bool
    aliases: [heel_lift_left]

  heel_lift_right:
    unit: bool
    aliases: [heel_lift_right]

  foot_contact_left:
    unit: bool
    aliases: [foot_contact_left]

  foot_contact_right:
    unit: bool
    aliases: [foot_contact_right]

  heels_grounded:
    unit: bool
    aliases: [heels_grounded, heels.on_floor, heels_contact_ok]

  # מרחקים עוזרי־אבחנה (פיצ'רים עתידיים/איזון)
  feet_width_px:
    unit: px
    aliases: [feet_width_px]

  shoulders_width_px:
    unit: px
    aliases: [shoulders_width_px]

  shoulders_delta_px:
    unit: px
    aliases: [shoulders_delta_px]

  hips_delta_px:
    unit: px
    aliases: [hips_delta_px]

  # ────────────────────────────────────────────────────────────────────────────
  # ראש (Head)
  # ────────────────────────────────────────────────────────────────────────────
  head_yaw_deg:
    unit: deg
    aliases: [head_yaw_deg, head.yaw_deg, head_yaw]

  head_pitch_deg:
    unit: deg
    aliases: [head_pitch_deg, head.pitch_deg, head_pitch]

  head_roll_deg:
    unit: deg
    aliases: [head_roll_deg, head.roll_deg, head_roll]

  head_confidence:
    unit: ratio
    aliases: [head_confidence, head.confidence]

  head_ok:
    unit: bool
    aliases: [head_ok, head.ok]

  # ────────────────────────────────────────────────────────────────────────────
  # חזרות: מצב / טיימינג / ROM / דגלים
  # ────────────────────────────────────────────────────────────────────────────
  rep.state:
    unit: text
    aliases: [rep.state]   # start / towards / turn / away

  rep.phase:
    unit: text
    aliases: [rep.phase]

  rep.dir:
    unit: text
    aliases: [rep.dir]     # inc / dec

  rep.active:
    unit: bool
    aliases: [rep.active]

  rep.in_rep_window:
    unit: bool
    aliases: [rep.in_rep_window]

  rep.freeze_active:
    unit: bool
    aliases: [rep.freeze_active]

  rep.rep_id:
    unit: count
    aliases: [rep.rep_id]

  rep.units:
    unit: text
    aliases: [rep.units]

  # טמפו
  rep.timing_s:
    unit: s
    aliases: [rep.timing_s, rep_time_s, rep_duration_s]

  rep.ecc_s:
    unit: s
    aliases: [rep.ecc_s, ecc_s]

  rep.con_s:
    unit: s
    aliases: [rep.con_s, con_s]

  rep.rest_s:
    unit: s
    aliases: [rep.rest_s]

  # עצירות
  rep.pause_top_s:
    unit: s
    aliases: [rep.pause_top_s, rep_hold_top_s, top_hold_s]

  rep.pause_bottom_s:
    unit: s
    aliases: [rep.pause_bottom_s, rep_hold_bottom_s, bottom_hold_s]

  # ROM/התקדמות
  rep.rom:
    unit: deg
    aliases: [rep.rom]

  rep.progress:
    unit: ratio
    aliases: [rep.progress]  # 0..1

  rep.eccentric:
    unit: bool
    aliases: [rep.eccentric]

  rep.concentric:
    unit: bool
    aliases: [rep.concentric]

  # איכות/אזהרות/שגיאות
  rep.quality:
    unit: text
    aliases: [rep.quality]  # good/fast/slow/short/incomplete

  rep.errors.fast_rep:
    unit: bool
    aliases: [rep.errors.fast_rep]

  rep.errors.slow_rep:
    unit: bool
    aliases: [rep.errors.slow_rep]

  rep.errors.small_rom:
    unit: bool
    aliases: [rep.errors.small_rom]

  rep.errors.missing_signal:
    unit: bool
    aliases: [rep.errors.missing_signal]

  rep.warnings.auto_signal_used:
    unit: bool
    aliases: [rep.warnings.auto_signal_used]

  rep.warnings.auto_target_used:
    unit: bool
    aliases: [rep.warnings.auto_target_used]

  # ────────────────────────────────────────────────────────────────────────────
  # Hinge ROM מפורק + יחס משולב (תמיכה ל־phrases.hinge.common.rom_joint)
  # ────────────────────────────────────────────────────────────────────────────
  hinge.hip_rom_deg:
    unit: deg
    aliases: [hinge.hip_rom_deg, hip_rom_deg]

  hinge.torso_rom_deg:
    unit: deg
    aliases: [hinge.torso_rom_deg, torso_rom_deg]

  hinge.rom_joint_ratio:
    unit: ratio
    aliases: [hinge.rom_joint_ratio, rom_joint_ratio]

  # ────────────────────────────────────────────────────────────────────────────
  # מפתחות "יעד/טווחי יעד" להצגה/כללים (נתוני יעד המגיעים מה-Engine/Config)
  # ────────────────────────────────────────────────────────────────────────────
  target.deg:
    unit: deg
    aliases: [target_deg, target.deg, rom_target_deg]

  measured.deg:
    unit: deg
    aliases: [measured_deg, rom_measured_deg]

  target.hip_deg:
    unit: deg
    aliases: [target_hip_deg, target.hip_deg]

  target.torso_deg:
    unit: deg
    aliases: [target_torso_deg, target.torso_deg]

  target.knee_min_deg:
    unit: deg
    aliases: [knee_min_deg, target.knee_min_deg]   # עומק מינימלי שנמדד/נדרש

  target.posture.max_good_deg:
    unit: deg
    aliases: [max_good_deg, target.posture.max_good_deg]

  target.tempo.min_s:
    unit: s
    aliases: [min_s, tempo_min_s, target.tempo.min_s]

  target.tempo.max_s:
    unit: s
    aliases: [max_s, tempo_max_s, target.tempo.max_s]

  target.stance_ratio.min:
    unit: ratio
    aliases: [target.stance_ratio.min, stance_min_ok, min_ok]

  target.stance_ratio.max:
    unit: ratio
    aliases: [target.stance_ratio.max, stance_max_ok, max_ok]

  target.valgus_deg:
    unit: deg
    aliases: [valgus_deg, target.valgus_deg]  # להצגה בטקסטים קצרים

  # ────────────────────────────────────────────────────────────────────────────
  # העברת משקל (גם כללית וגם ratio מפורש)
  # ────────────────────────────────────────────────────────────────────────────
  weight_shift:
    unit: ratio
    aliases: [weight_shift]

  weight_shift_ratio:
    unit: ratio
    aliases: [weight_shift_ratio, weight_shift]  # לשימוש בטקסט (ממופה ליחס)

# =============================================================================
# טולרנסים בין aliases של אותו מפתח קנוני
# =============================================================================
tolerances:
  deg:     0.5
  deg_s:   1.0
  deg_s2:  10.0
  ratio:   0.02
  s:       0.05
  px:      2.0
  ms:      30.0
  count:   0
  text:    0
  bool:    0

# =============================================================================
# 🛠️ רעיונות עתידיים (תיעוד בלבד)
# =============================================================================
# 1) ROM מפורק למפרקים נוספים: knee_rom_deg / elbow_rom_deg (deg)
# 2) מדדי “turn quality” כמותיים: turn_sharpness (ratio), turn_dt_s (s)
# 3) מדדי סימטריה: symmetry.knee_diff_deg / symmetry.hip_diff_deg / symmetry.shoulder_diff_deg
# 4) Hinge Ratio מורחב: torso_forward_deg / avg(knee_left/right_deg)
# 5) balance_score מתנועה צדית מנורמלת (shoulders_delta_px / hips_delta_px)
# 6) bar/object_x (px) למסלול אופקי (“קרב את העומס לגוף”)
# 7) grip_width_px (px) והשפעות על torque כתף/מרפק
